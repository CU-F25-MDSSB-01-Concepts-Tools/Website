<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jan Lorenz">

<title>W#09: Hypothesis Testing, Classification and Regression with Decision Trees, Overfitting – Data Science Concepts / Data Science Tools</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d90c30c96bad360bae691b5c26d18f86.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Data Science Concepts / Data Science Tools</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">W#09: Hypothesis Testing, Classification and Regression with Decision Trees, Overfitting</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Schedule</strong></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./late.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Onboarding Late-arriving</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./homework.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework Projects</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final Project</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Help Project Work</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./literature.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Literature</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#packages-used-here" id="toc-packages-used-here" class="nav-link active" data-scroll-target="#packages-used-here"><span class="header-section-number">0.1</span> Packages used here</a></li>
  <li><a href="#hypothesis-testing" id="toc-hypothesis-testing" class="nav-link" data-scroll-target="#hypothesis-testing"><span class="header-section-number">1</span> Hypothesis testing</a>
  <ul class="collapse">
  <li><a href="#organ-donors" id="toc-organ-donors" class="nav-link" data-scroll-target="#organ-donors"><span class="header-section-number">1.1</span> Organ donors</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">1.2</span> Data</a></li>
  <li><a href="#parameter-vs.-statistic" id="toc-parameter-vs.-statistic" class="nav-link" data-scroll-target="#parameter-vs.-statistic"><span class="header-section-number">1.3</span> Parameter vs.&nbsp;statistic</a></li>
  <li><a href="#correlation-vs.-causation" id="toc-correlation-vs.-causation" class="nav-link" data-scroll-target="#correlation-vs.-causation"><span class="header-section-number">1.4</span> Correlation vs.&nbsp;causation</a></li>
  <li><a href="#two-claims" id="toc-two-claims" class="nav-link" data-scroll-target="#two-claims"><span class="header-section-number">1.5</span> Two claims</a></li>
  <li><a href="#understand-hypothesis-testing-as-a-court-trial" id="toc-understand-hypothesis-testing-as-a-court-trial" class="nav-link" data-scroll-target="#understand-hypothesis-testing-as-a-court-trial"><span class="header-section-number">1.6</span> Understand hypothesis testing as a court trial</a></li>
  <li><a href="#hypothesis-testing-framework" id="toc-hypothesis-testing-framework" class="nav-link" data-scroll-target="#hypothesis-testing-framework"><span class="header-section-number">1.7</span> Hypothesis testing framework</a></li>
  <li><a href="#setting-the-hypotheses" id="toc-setting-the-hypotheses" class="nav-link" data-scroll-target="#setting-the-hypotheses"><span class="header-section-number">1.8</span> Setting the hypotheses</a></li>
  </ul></li>
  <li><a href="#simulation-for-hypothesis-testing" id="toc-simulation-for-hypothesis-testing" class="nav-link" data-scroll-target="#simulation-for-hypothesis-testing"><span class="header-section-number">2</span> Simulation for Hypothesis Testing</a>
  <ul class="collapse">
  <li><a href="#simulating-the-null-distribution" id="toc-simulating-the-null-distribution" class="nav-link" data-scroll-target="#simulating-the-null-distribution"><span class="header-section-number">2.1</span> Simulating the null distribution</a></li>
  <li><a href="#simulation" id="toc-simulation" class="nav-link" data-scroll-target="#simulation"><span class="header-section-number">2.2</span> Simulation!</a></li>
  <li><a href="#more-simulation" id="toc-more-simulation" class="nav-link" data-scroll-target="#more-simulation"><span class="header-section-number">2.3</span> More simulation!</a></li>
  <li><a href="#automating-with-tidymodels" id="toc-automating-with-tidymodels" class="nav-link" data-scroll-target="#automating-with-tidymodels"><span class="header-section-number">2.4</span> Automating with <code>tidymodels</code></a></li>
  <li><a href="#visualizing-the-null-distribution" id="toc-visualizing-the-null-distribution" class="nav-link" data-scroll-target="#visualizing-the-null-distribution"><span class="header-section-number">2.5</span> Visualizing the null distribution</a></li>
  </ul></li>
  <li><a href="#p-value" id="toc-p-value" class="nav-link" data-scroll-target="#p-value"><span class="header-section-number">3</span> p-value</a>
  <ul class="collapse">
  <li><a href="#calculating-the-p-value-visually" id="toc-calculating-the-p-value-visually" class="nav-link" data-scroll-target="#calculating-the-p-value-visually"><span class="header-section-number">3.1</span> Calculating the p-value, visually</a></li>
  <li><a href="#calculating-the-p-value-directly" id="toc-calculating-the-p-value-directly" class="nav-link" data-scroll-target="#calculating-the-p-value-directly"><span class="header-section-number">3.2</span> Calculating the p-value, directly</a></li>
  <li><a href="#significance-level" id="toc-significance-level" class="nav-link" data-scroll-target="#significance-level"><span class="header-section-number">3.3</span> Significance level</a></li>
  <li><a href="#simulations-is-not-sufficient" id="toc-simulations-is-not-sufficient" class="nav-link" data-scroll-target="#simulations-is-not-sufficient"><span class="header-section-number">3.4</span> 100 simulations is not sufficient</a></li>
  <li><a href="#our-more-robust-p-value" id="toc-our-more-robust-p-value" class="nav-link" data-scroll-target="#our-more-robust-p-value"><span class="header-section-number">3.5</span> Our more robust p-value</a></li>
  <li><a href="#p-value-in-model-outputs" id="toc-p-value-in-model-outputs" class="nav-link" data-scroll-target="#p-value-in-model-outputs"><span class="header-section-number">3.6</span> p-value in model outputs</a></li>
  <li><a href="#xkcd-on-p-values" id="toc-xkcd-on-p-values" class="nav-link" data-scroll-target="#xkcd-on-p-values"><span class="header-section-number">3.7</span> xkcd on p-values</a></li>
  <li><a href="#p-value-misinterpretation" id="toc-p-value-misinterpretation" class="nav-link" data-scroll-target="#p-value-misinterpretation"><span class="header-section-number">3.8</span> p-value misinterpretation</a></li>
  </ul></li>
  <li><a href="#classification-compare-logistic-regression-and-decision-tree" id="toc-classification-compare-logistic-regression-and-decision-tree" class="nav-link" data-scroll-target="#classification-compare-logistic-regression-and-decision-tree"><span class="header-section-number">4</span> Classification: Compare logistic regression and decision tree</a>
  <ul class="collapse">
  <li><a href="#purpose-of-the-section" id="toc-purpose-of-the-section" class="nav-link" data-scroll-target="#purpose-of-the-section"><span class="header-section-number">4.1</span> Purpose of the section</a></li>
  <li><a href="#specify-recipe-and-models" id="toc-specify-recipe-and-models" class="nav-link" data-scroll-target="#specify-recipe-and-models"><span class="header-section-number">4.2</span> Specify recipe and models</a></li>
  <li><a href="#split-and-fit" id="toc-split-and-fit" class="nav-link" data-scroll-target="#split-and-fit"><span class="header-section-number">4.3</span> Split and fit</a></li>
  <li><a href="#look-at-fitted-logistic-regression" id="toc-look-at-fitted-logistic-regression" class="nav-link" data-scroll-target="#look-at-fitted-logistic-regression"><span class="header-section-number">4.4</span> Look at fitted logistic regression</a></li>
  <li><a href="#what-is-a-decision-tree" id="toc-what-is-a-decision-tree" class="nav-link" data-scroll-target="#what-is-a-decision-tree"><span class="header-section-number">4.5</span> What is a decision tree?</a></li>
  <li><a href="#show-rules" id="toc-show-rules" class="nav-link" data-scroll-target="#show-rules"><span class="header-section-number">4.6</span> Show rules</a></li>
  <li><a href="#visualize-tree" id="toc-visualize-tree" class="nav-link" data-scroll-target="#visualize-tree"><span class="header-section-number">4.7</span> Visualize tree</a></li>
  <li><a href="#make-predictions-for-test-data" id="toc-make-predictions-for-test-data" class="nav-link" data-scroll-target="#make-predictions-for-test-data"><span class="header-section-number">4.8</span> Make predictions for test data</a></li>
  </ul></li>
  <li><a href="#regression-compare-linear-regression-and-decision-tree" id="toc-regression-compare-linear-regression-and-decision-tree" class="nav-link" data-scroll-target="#regression-compare-linear-regression-and-decision-tree"><span class="header-section-number">5</span> Regression: Compare linear regression and decision tree</a>
  <ul class="collapse">
  <li><a href="#purpose-of-the-section-1" id="toc-purpose-of-the-section-1" class="nav-link" data-scroll-target="#purpose-of-the-section-1"><span class="header-section-number">5.1</span> Purpose of the section</a></li>
  <li><a href="#specify-recipe-and-models-1" id="toc-specify-recipe-and-models-1" class="nav-link" data-scroll-target="#specify-recipe-and-models-1"><span class="header-section-number">5.2</span> Specify recipe and models</a></li>
  <li><a href="#fit-regression-models" id="toc-fit-regression-models" class="nav-link" data-scroll-target="#fit-regression-models"><span class="header-section-number">5.3</span> Fit Regression Models</a></li>
  <li><a href="#look-at-fitted-linear-regression" id="toc-look-at-fitted-linear-regression" class="nav-link" data-scroll-target="#look-at-fitted-linear-regression"><span class="header-section-number">5.4</span> Look at fitted linear regression</a></li>
  <li><a href="#show-rules-1" id="toc-show-rules-1" class="nav-link" data-scroll-target="#show-rules-1"><span class="header-section-number">5.5</span> Show rules</a></li>
  <li><a href="#visualize-tree-1" id="toc-visualize-tree-1" class="nav-link" data-scroll-target="#visualize-tree-1"><span class="header-section-number">5.6</span> Visualize tree</a></li>
  <li><a href="#make-predictions-for-test-data-1" id="toc-make-predictions-for-test-data-1" class="nav-link" data-scroll-target="#make-predictions-for-test-data-1"><span class="header-section-number">5.7</span> Make predictions for test data</a></li>
  <li><a href="#regression-performance-evaluation" id="toc-regression-performance-evaluation" class="nav-link" data-scroll-target="#regression-performance-evaluation"><span class="header-section-number">5.8</span> Regression Performance Evaluation</a></li>
  <li><a href="#what-rmse-is-better" id="toc-what-rmse-is-better" class="nav-link" data-scroll-target="#what-rmse-is-better"><span class="header-section-number">5.9</span> What RMSE is better?</a></li>
  <li><a href="#interpreting-rmse" id="toc-interpreting-rmse" class="nav-link" data-scroll-target="#interpreting-rmse"><span class="header-section-number">5.10</span> Interpreting RMSE</a></li>
  </ul></li>
  <li><a href="#overfitting-with-decision-trees" id="toc-overfitting-with-decision-trees" class="nav-link" data-scroll-target="#overfitting-with-decision-trees"><span class="header-section-number">6</span> Overfitting with decision trees</a>
  <ul class="collapse">
  <li><a href="#compare-training-and-test-data" id="toc-compare-training-and-test-data" class="nav-link" data-scroll-target="#compare-training-and-test-data"><span class="header-section-number">6.1</span> Compare training and test data</a></li>
  <li><a href="#make-a-deeper-tree" id="toc-make-a-deeper-tree" class="nav-link" data-scroll-target="#make-a-deeper-tree"><span class="header-section-number">6.2</span> Make a deeper tree</a></li>
  <li><a href="#the-deep-tree" id="toc-the-deep-tree" class="nav-link" data-scroll-target="#the-deep-tree"><span class="header-section-number">6.3</span> The deep tree</a></li>
  <li><a href="#compare-pruned-and-deep-tree" id="toc-compare-pruned-and-deep-tree" class="nav-link" data-scroll-target="#compare-pruned-and-deep-tree"><span class="header-section-number">6.4</span> Compare pruned and deep tree</a></li>
  <li><a href="#more-in-an-r-script" id="toc-more-in-an-r-script" class="nav-link" data-scroll-target="#more-in-an-r-script"><span class="header-section-number">6.5</span> More in an R-script</a></li>
  </ul></li>
  <li><a href="#what-do-we-mean-by-model-how-to-be-specific" id="toc-what-do-we-mean-by-model-how-to-be-specific" class="nav-link" data-scroll-target="#what-do-we-mean-by-model-how-to-be-specific"><span class="header-section-number">7</span> What do we mean by “model”? How to be specific</a>
  <ul class="collapse">
  <li><a href="#model-in-statistical-learning" id="toc-model-in-statistical-learning" class="nav-link" data-scroll-target="#model-in-statistical-learning"><span class="header-section-number">7.1</span> “Model” in Statistical Learning</a></li>
  <li><a href="#more-specific-fitted-model" id="toc-more-specific-fitted-model" class="nav-link" data-scroll-target="#more-specific-fitted-model"><span class="header-section-number">7.2</span> More specific: Fitted model</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="W09.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">W#09: Hypothesis Testing, Classification and Regression with Decision Trees, Overfitting</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jan Lorenz </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="packages-used-here" class="level2" data-number="0.1">
<h2 data-number="0.1" class="anchored" data-anchor-id="packages-used-here"><span class="header-section-number">0.1</span> Packages used here</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.3.0 ──
✔ broom        1.0.9     ✔ rsample      1.3.1
✔ dials        1.4.1     ✔ tune         1.3.0
✔ infer        1.0.9     ✔ workflows    1.3.0
✔ modeldata    1.5.1     ✔ workflowsets 1.1.1
✔ parsnip      1.3.2     ✔ yardstick    1.3.2
✔ recipes      1.3.1     
── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ scales::discard() masks purrr::discard()
✖ dplyr::filter()   masks stats::filter()
✖ recipes::fixed()  masks stringr::fixed()
✖ dplyr::lag()      masks stats::lag()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: rpart

Attaching package: 'rpart'

The following object is masked from 'package:dials':

    prune</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openintro)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: airports
Loading required package: cherryblossom
Loading required package: usdata

Attaching package: 'openintro'

The following object is masked from 'package:modeldata':

    ames</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'palmerpenguins'

The following object is masked from 'package:modeldata':

    penguins

The following objects are masked from 'package:datasets':

    penguins, penguins_raw</code></pre>
</div>
</div>
</section>
<section id="hypothesis-testing" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Hypothesis testing</h1>
<p>Large part of the content adapted from <a href="http://datasciencebox.org" class="uri">http://datasciencebox.org</a>.</p>
<section id="organ-donors" class="level2 smaller" data-number="1.1">
<h2 class="smaller anchored" data-number="1.1" data-anchor-id="organ-donors"><span class="header-section-number">1.1</span> Organ donors</h2>
<p><strong>Background story:</strong> People providing an organ for donation sometimes seek the help of a special “medical consultant”. These consultants assist the patient in all aspects of the surgery, with the goal of reducing the possibility of complications during the medical procedure and recovery. Patients might choose a consultant based in part on the historical complication rate of the consultant’s clients.</p>
<p>. . .</p>
<p><strong>Example track record:</strong> One consultant tried to attract patients by noting that the average complication rate for liver donor surgeries in the US is about 10%, but her clients have only had 3 complications in the 62 liver donor surgeries she has facilitated. She claims this is strong evidence that her work meaningfully contributes to reducing complications (and therefore she should be hired!).</p>
<p>. . .</p>
<p><span style="color:red;">Is this strong evidence for a good track record?</span></p>
</section>
<section id="data" class="level2 smaller" data-number="1.2">
<h2 class="smaller anchored" data-number="1.2" data-anchor-id="data"><span class="header-section-number">1.2</span> Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>organ_donor <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"complication"</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="st">"no complication"</span>, <span class="dv">59</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>organ_donor <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(outcome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  outcome             n
  &lt;chr&gt;           &lt;int&gt;
1 complication        3
2 no complication    59</code></pre>
</div>
</div>
</section>
<section id="parameter-vs.-statistic" class="level2 smaller" data-number="1.3">
<h2 class="smaller anchored" data-number="1.3" data-anchor-id="parameter-vs.-statistic"><span class="header-section-number">1.3</span> Parameter vs.&nbsp;statistic</h2>
<p>A <strong>parameter</strong> for a hypothesis test is the “true” value of interest. We typically estimate the parameter using a <strong>sample statistic</strong> as a <strong>point estimate</strong>.</p>
<p><span class="math inline">\(q\)</span>: true rate of complication, here 0.1 (10% complication rate in US)</p>
<p><span class="math inline">\(\hat{q}\)</span>: rate of complication in the sample = <span class="math inline">\(\frac{3}{62}\)</span> = 0.048 (This is the point estimate.)</p>
</section>
<section id="correlation-vs.-causation" class="level2 smaller" data-number="1.4">
<h2 class="smaller anchored" data-number="1.4" data-anchor-id="correlation-vs.-causation"><span class="header-section-number">1.4</span> Correlation vs.&nbsp;causation</h2>
<p><strong>Is it possible to infer the consultant’s claim using the data?</strong></p>
<p>No.&nbsp;The claim is: <em>There is a causal connection</em>. However, the data are observational. For example, maybe patients who can afford a medical consultant can afford better medical care, which can also lead to a lower complication rate (for example).</p>
<p>. . .</p>
<p><strong>What is possible?</strong></p>
<p>While it is not possible to assess the causal claim, it is still possible to test for an association using these data. For this question we ask, <strong>could the low complication rate of <span class="math inline">\(\hat{q}\)</span> = 0.048 be due to chance?</strong></p>
</section>
<section id="two-claims" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="two-claims"><span class="header-section-number">1.5</span> Two claims</h2>
<ul>
<li><span style="color:blue;"><strong>Null hypothesis <span class="math inline">\(H_0\)</span>:</strong></span> “There is nothing going on”</li>
</ul>
<p>Complication rate for this consultant is no different than the US average of 10%</p>
<ul>
<li><span style="color:blue;"><strong>Alternative hypothesis <span class="math inline">\(H_1\)</span>:</strong></span> “There is something going on”</li>
</ul>
<p>Complication rate for this consultant is <strong>lower</strong> than the US average of 10%</p>
</section>
<section id="understand-hypothesis-testing-as-a-court-trial" class="level2 smaller" data-number="1.6">
<h2 class="smaller anchored" data-number="1.6" data-anchor-id="understand-hypothesis-testing-as-a-court-trial"><span class="header-section-number">1.6</span> Understand hypothesis testing as a court trial</h2>
<ul>
<li><p><strong>Null hypothesis</strong>, <span class="math inline">\(H_0\)</span>: Defendant is innocent</p></li>
<li><p><strong>Alternative hypothesis</strong>, <span class="math inline">\(H_A\)</span>: Defendant is guilty</p></li>
<li><p><strong>Present the evidence:</strong> Collect data</p></li>
<li><p><strong>Judge the evidence:</strong> “Could these data plausibly have happened by chance if the null hypothesis were true?”</p>
<ul>
<li>Yes: Fail to reject <span class="math inline">\(H_0\)</span></li>
<li>No: Reject <span class="math inline">\(H_0\)</span></li>
</ul></li>
</ul>
</section>
<section id="hypothesis-testing-framework" class="level2 smaller" data-number="1.7">
<h2 class="smaller anchored" data-number="1.7" data-anchor-id="hypothesis-testing-framework"><span class="header-section-number">1.7</span> Hypothesis testing framework</h2>
<ul>
<li><p>Start with a null hypothesis, <span class="math inline">\(H_0\)</span>, that represents the status quo</p></li>
<li><p>Set an alternative hypothesis, <span class="math inline">\(H_A\)</span>, that represents the research question, i.e.&nbsp;what we are testing for</p></li>
<li><p>Conduct a hypothesis test under the assumption that the null hypothesis is true and calculate a <strong>p-value</strong>.<br>
<strong>Definition p-value:</strong> <em>Probability of observed or more extreme outcome given that the null hypothesis is true.</em></p>
<ul>
<li>if the test results suggest that the data do not provide convincing evidence for the alternative hypothesis, stick with the null hypothesis</li>
<li>if they do, then reject the null hypothesis in favor of the alternative</li>
</ul></li>
</ul>
</section>
<section id="setting-the-hypotheses" class="level2 smaller" data-number="1.8">
<h2 class="smaller anchored" data-number="1.8" data-anchor-id="setting-the-hypotheses"><span class="header-section-number">1.8</span> Setting the hypotheses</h2>
<p>Which of the following is the correct set of hypotheses for the claim that the consultant has lower complication rates?</p>
<ol type="a">
<li><p><span class="math inline">\(H_0: q = 0.10\)</span>; <span class="math inline">\(H_A: q \ne 0.10\)</span></p></li>
<li><p><span class="math inline">\(H_0: q = 0.10\)</span>; <span class="math inline">\(H_A: q &gt; 0.10\)</span></p></li>
<li><p><span class="math inline">\(H_0: q = 0.10\)</span>; <span class="math inline">\(H_A: q &lt; 0.10\)</span></p></li>
<li><p><span class="math inline">\(H_0: \hat{q} = 0.10\)</span>; <span class="math inline">\(H_A: \hat{q} \ne 0.10\)</span></p></li>
<li><p><span class="math inline">\(H_0: \hat{q} = 0.10\)</span>; <span class="math inline">\(H_A: \hat{q} &gt; 0.10\)</span></p></li>
<li><p><span class="math inline">\(H_0: \hat{q} = 0.10\)</span>; <span class="math inline">\(H_A: \hat{q} &lt; 0.10\)</span></p></li>
</ol>
<p>. . .</p>
<ol start="3" type="a">
<li>is correct.<br>
Hypotheses are about the true rate of complication <span class="math inline">\(q\)</span> not the observed ones <span class="math inline">\(\hat{q}\)</span></li>
</ol>
</section>
</section>
<section id="simulation-for-hypothesis-testing" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Simulation for Hypothesis Testing</h1>
<section id="simulating-the-null-distribution" class="level2 smaller" data-number="2.1">
<h2 class="smaller anchored" data-number="2.1" data-anchor-id="simulating-the-null-distribution"><span class="header-section-number">2.1</span> Simulating the null distribution</h2>
<p>Since <span class="math inline">\(H_0: q = 0.10\)</span>, we need to simulate a null distribution where the probability of success (complication) for each trial (patient) is 0.10.</p>
<p><strong>How should we simulate the null distribution for this study using a bag of chips?</strong></p>
<ul>
<li>How many chips? <span class="fragment" style="color:red;">For example 10 which makes 10% choices possible</span></li>
<li>How many colors? <span class="fragment" style="color:red;">2</span></li>
<li>What should colors represent? <span class="fragment" style="color:red;">“complication”, “no complication”</span></li>
<li>How many draws? <span class="fragment" style="color:red;">62 as the data</span></li>
<li>With replacement or without replacement? <span class="fragment" style="color:red;">With replacement</span></li>
</ul>
<p>When sampling from the null distribution, what would be the expected proportion of “complications”? <span class="fragment" style="color:red;">0.1</span></p>
</section>
<section id="simulation" class="level2 smaller" data-number="2.2">
<h2 class="smaller anchored" data-number="2.2" data-anchor-id="simulation"><span class="header-section-number">2.2</span> Simulation!</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># The seed is set for the sake of stable presentation outcomes.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>outcomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"complication"</span>, <span class="st">"no complication"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>sim1 <span class="ot">&lt;-</span> <span class="fu">sample</span>(outcomes, <span class="at">size =</span> <span class="dv">62</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>sim1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "no complication" "no complication" "no complication" "no complication"
 [5] "no complication" "no complication" "no complication" "no complication"
 [9] "no complication" "no complication" "no complication" "no complication"
[13] "no complication" "complication"    "no complication" "no complication"
[17] "no complication" "no complication" "no complication" "no complication"
[21] "no complication" "no complication" "no complication" "no complication"
[25] "no complication" "no complication" "no complication" "complication"   
[29] "no complication" "no complication" "no complication" "no complication"
[33] "no complication" "no complication" "no complication" "no complication"
[37] "no complication" "no complication" "complication"    "no complication"
[41] "no complication" "no complication" "no complication" "no complication"
[45] "no complication" "no complication" "no complication" "no complication"
[49] "no complication" "no complication" "no complication" "no complication"
[53] "no complication" "no complication" "no complication" "no complication"
[57] "no complication" "no complication" "no complication" "no complication"
[61] "no complication" "no complication"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(sim1 <span class="sc">==</span> <span class="st">"complication"</span>)<span class="sc">/</span><span class="dv">62</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0483871</code></pre>
</div>
</div>
<p>Oh OK, this was exactly the consultant’s rate. But maybe it was a rare event? Let us repeat it.</p>
</section>
<section id="more-simulation" class="level2 smaller" data-number="2.3">
<h2 class="smaller anchored" data-number="2.3" data-anchor-id="more-simulation"><span class="header-section-number">2.3</span> More simulation!</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>one_sim <span class="ot">&lt;-</span> <span class="cf">function</span>() <span class="fu">sample</span>(outcomes, <span class="at">size =</span> <span class="dv">62</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">one_sim</span>() <span class="sc">==</span> <span class="st">"complication"</span>)<span class="sc">/</span><span class="dv">62</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1290323</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">one_sim</span>() <span class="sc">==</span> <span class="st">"complication"</span>)<span class="sc">/</span><span class="dv">62</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1290323</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">one_sim</span>() <span class="sc">==</span> <span class="st">"complication"</span>)<span class="sc">/</span><span class="dv">62</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09677419</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">one_sim</span>() <span class="sc">==</span> <span class="st">"complication"</span>)<span class="sc">/</span><span class="dv">62</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.09677419</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">one_sim</span>() <span class="sc">==</span> <span class="st">"complication"</span>)<span class="sc">/</span><span class="dv">62</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1774194</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">one_sim</span>() <span class="sc">==</span> <span class="st">"complication"</span>)<span class="sc">/</span><span class="dv">62</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1129032</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">one_sim</span>() <span class="sc">==</span> <span class="st">"complication"</span>)<span class="sc">/</span><span class="dv">62</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1129032</code></pre>
</div>
</div>
</section>
<section id="automating-with-tidymodels" class="level2 smaller" data-number="2.4">
<h2 class="smaller anchored" data-number="2.4" data-anchor-id="automating-with-tidymodels"><span class="header-section-number">2.4</span> Automating with <code>tidymodels</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>organ_donor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 62 × 1
   outcome        
   &lt;chr&gt;          
 1 complication   
 2 complication   
 3 complication   
 4 no complication
 5 no complication
 6 no complication
 7 no complication
 8 no complication
 9 no complication
10 no complication
# ℹ 52 more rows</code></pre>
</div>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>null_dist <span class="ot">&lt;-</span> organ_donor <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(<span class="at">response =</span> outcome, <span class="at">success =</span> <span class="st">"complication"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hypothesize</span>(<span class="at">null =</span> <span class="st">"point"</span>, </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">p =</span> <span class="fu">c</span>(<span class="st">"complication"</span> <span class="ot">=</span> <span class="fl">0.10</span>, <span class="st">"no complication"</span> <span class="ot">=</span> <span class="fl">0.90</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">100</span>, <span class="at">type =</span> <span class="st">"draw"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"prop"</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>null_dist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Response: outcome (factor)
Null Hypothesis: point
# A tibble: 100 × 2
   replicate   stat
       &lt;int&gt;  &lt;dbl&gt;
 1         1 0.0323
 2         2 0.0645
 3         3 0.0968
 4         4 0.0161
 5         5 0.161 
 6         6 0.0968
 7         7 0.0645
 8         8 0.129 
 9         9 0.161 
10        10 0.0968
# ℹ 90 more rows</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="visualizing-the-null-distribution" class="level2 smaller" data-number="2.5">
<h2 class="smaller anchored" data-number="2.5" data-anchor-id="visualizing-the-null-distribution"><span class="header-section-number">2.5</span> Visualizing the null distribution</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> null_dist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> stat)) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Null distribution"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W09_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="p-value" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> p-value</h1>
<section id="calculating-the-p-value-visually" class="level2 smaller" data-number="3.1">
<h2 class="smaller anchored" data-number="3.1" data-anchor-id="calculating-the-p-value-visually"><span class="header-section-number">3.1</span> Calculating the p-value, visually</h2>
<p><strong>What is the p-value:</strong> <em>How often was the simulated sample proportion at least as extreme as the observed sample proportion?</em><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> null_dist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> stat)) <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Null distribution"</span>)  <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">62</span>, <span class="at">color =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W09_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="calculating-the-p-value-directly" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="calculating-the-p-value-directly"><span class="header-section-number">3.2</span> Calculating the p-value, directly</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>null_dist <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">summarise</span>(<span class="at">p_value =</span> <span class="fu">sum</span>(stat <span class="sc">&lt;=</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">62</span>)<span class="sc">/</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  p_value
    &lt;dbl&gt;
1    0.13</code></pre>
</div>
</div>
<p>This is the fraction of simulations where complications was equal or below 0.0483871.</p>
</section>
<section id="significance-level" class="level2 smaller" data-number="3.3">
<h2 class="smaller anchored" data-number="3.3" data-anchor-id="significance-level"><span class="header-section-number">3.3</span> Significance level</h2>
<ul>
<li><p>A <strong>significance level</strong> <span class="math inline">\(\alpha\)</span> is a threshold we make up to make our judgment about the plausibility of the null hypothesis being true given the observed data.</p></li>
<li><p>We often use <span class="math inline">\(\alpha = 0.05 = 5\%\)</span> as the cutoff for whether the p-value is low enough that the data are unlikely to have come from the null model.</p></li>
<li><p>If p-value &lt; <span class="math inline">\(\alpha\)</span>, reject <span class="math inline">\(H_0\)</span> in favor of <span class="math inline">\(H_A\)</span>: The data provide convincing evidence for the alternative hypothesis.</p></li>
<li><p>If p-value &gt; <span class="math inline">\(\alpha\)</span>, fail to reject <span class="math inline">\(H_0\)</span> in favor of <span class="math inline">\(H_A\)</span>: The data do not provide convincing evidence for the alternative hypothesis.</p></li>
</ul>
<p><strong>What is the conclusion of the hypothesis test?</strong></p>
<p>Since the p-value is greater than the significance level, we fail to reject the null hypothesis. These data do not provide convincing evidence that this consultant incurs a lower complication rate than the 10% overall US complication rate.</p>
</section>
<section id="simulations-is-not-sufficient" class="level2 smaller" data-number="3.4">
<h2 class="smaller anchored" data-number="3.4" data-anchor-id="simulations-is-not-sufficient"><span class="header-section-number">3.4</span> 100 simulations is not sufficient</h2>
<ul>
<li>We simulate 15,000 times to get an accurate distribution.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>null_dist <span class="ot">&lt;-</span> organ_donor <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(<span class="at">response =</span> outcome, <span class="at">success =</span> <span class="st">"complication"</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hypothesize</span>(<span class="at">null =</span> <span class="st">"point"</span>, </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">p =</span> <span class="fu">c</span>(<span class="st">"complication"</span> <span class="ot">=</span> <span class="fl">0.10</span>, <span class="st">"no complication"</span> <span class="ot">=</span> <span class="fl">0.90</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">15000</span>, <span class="at">type =</span> <span class="st">"simulate"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"prop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>The `"simulate"` generation type has been renamed to `"draw"`. Use `type =
"draw"` instead to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> null_dist, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> stat)) <span class="sc">+</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">62</span>, <span class="at">color =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W09_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="our-more-robust-p-value" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="our-more-robust-p-value"><span class="header-section-number">3.5</span> Our more robust p-value</h2>
<p>For the null distribution with 15,000 simulations</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>null_dist <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stat <span class="sc">&lt;=</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">62</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p_value =</span> <span class="fu">n</span>()<span class="sc">/</span><span class="fu">nrow</span>(null_dist))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  p_value
    &lt;dbl&gt;
1   0.125</code></pre>
</div>
</div>
<p>Oh OK, our first p-value was much more borderline in favor of the alternative hypothesis.</p>
</section>
<section id="p-value-in-model-outputs" class="level2 smaller" data-number="3.6">
<h2 class="smaller anchored" data-number="3.6" data-anchor-id="p-value-in-model-outputs"><span class="header-section-number">3.6</span> p-value in model outputs</h2>
<p>Model output for a linear model with palmer penguins.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">linear_reg</span>() <span class="sc">|&gt;</span> <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fit</span>(bill_length_mm <span class="sc">~</span> bill_depth_mm, <span class="at">data =</span> penguins) <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term          estimate std.error statistic  p.value
  &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)     55.1       2.52      21.9  6.91e-67
2 bill_depth_mm   -0.650     0.146     -4.46 1.12e- 5</code></pre>
</div>
</div>
<p>Model output for a logistic regression model with email from <a href="https://www.openintro.org/data/index.php?data=email">openintro</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(spam <span class="sc">~</span> from <span class="sc">+</span> cc, <span class="at">data =</span> email, <span class="at">family =</span> <span class="st">"binomial"</span>) <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term         estimate std.error statistic p.value
  &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
1 (Intercept)  13.6      309.        0.0439   0.965
2 from1       -15.8      309.       -0.0513   0.959
3 cc            0.00423    0.0193    0.220    0.826</code></pre>
</div>
</div>
<p>What do the p-values mean? What is the null hypothesis?</p>
<p>. . .</p>
<p><strong>Null-Hypothesis:</strong> There is no relationship between the predictor variable and the response variable, that means that the coefficient is equal to zero.</p>
<p><strong>Smaller p-value</strong> <span class="math inline">\(\to\)</span> more evidence for rejecting the hypothesis that there is no effect.</p>
</section>
<section id="xkcd-on-p-values" class="level2 smaller" data-number="3.7">
<h2 class="smaller anchored" data-number="3.7" data-anchor-id="xkcd-on-p-values"><span class="header-section-number">3.7</span> xkcd on p-values</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p><a href="https://xkcd.com/1478/"><img src="https://imgs.xkcd.com/comics/p_values_2x.png" height="500"></a> <a href="https://xkcd.com/882/"><img src="https://imgs.xkcd.com/comics/significant.png" height="500"></a></p>
</div><div class="column" style="width:40%;">
<div class="fragment">
<ul>
<li>Significance levels are fairly arbitrary. Sometimes they are used (wrongly) as definitive judgments</li>
<li>They can even be used to do <em>p-hacking</em>: Searching for “significant” effects in observational data</li>
<li>In parts of science it has become a “gamed” performance metric.</li>
<li>The p-value says nothing about effect size!</li>
</ul>
</div>
</div>
</div>
</section>
<section id="p-value-misinterpretation" class="level2 smaller" data-number="3.8">
<h2 class="smaller anchored" data-number="3.8" data-anchor-id="p-value-misinterpretation"><span class="header-section-number">3.8</span> p-value misinterpretation</h2>
<p>p-values do not measure<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<ul>
<li>the probability that the studied hypothesis is true</li>
<li>the probability that the data were produced by random chance alone</li>
<li>the size of an effect</li>
<li>the “importance of a result” or “evidence regarding a model or hypothesis” (it is only against the null hypothesis).</li>
</ul>
<p>. . .</p>
<p>Correct:<br>
The p-value is the probability of obtaining test results at least as extreme as the result actually observed, under the assumption that the null hypothesis is correct.</p>
<p>p-values and significance tests, when properly applied and interpreted, increase the rigor of the conclusions drawn from data.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
</section>
</section>
<section id="classification-compare-logistic-regression-and-decision-tree" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Classification: Compare logistic regression and decision tree</h1>
<section id="purpose-of-the-section" class="level2 smaller" data-number="4.1">
<h2 class="smaller anchored" data-number="4.1" data-anchor-id="purpose-of-the-section"><span class="header-section-number">4.1</span> Purpose of the section</h2>
<ul>
<li>Go again through the modeling workflow (with <code>tidymodels</code>) and see that large parts are identical</li>
<li>Look again at the coefficients of a logistic regression model</li>
<li>Learn the basic idea of a decision tree (you will not learn the details here)</li>
<li>Do the classification with both models and compare the confusion matrices</li>
</ul>
</section>
<section id="specify-recipe-and-models" class="level2 smaller" data-number="4.2">
<h2 class="smaller anchored" data-number="4.2" data-anchor-id="specify-recipe-and-models"><span class="header-section-number">4.2</span> Specify recipe and models</h2>
<p>For both logistic regression and decision tree:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>peng_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(sex <span class="sc">~</span> ., <span class="at">data =</span> penguins) <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_rm</span>(year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<ul>
<li>We specify a recipe to predict <code>sex</code> with all available variables in <code>penguins</code>
<ul>
<li>In typical model development, more pre-processing steps are done.</li>
</ul></li>
</ul>
<p>. . .</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Logistic Regression</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>peng_logreg <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">set_engine</span>(<span class="st">"glm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>peng_logreg</code> specifies to fit with <code>glm</code> (generalized linear model from <code>base</code> R)</p>
</div><div class="column" style="width:50%;">
<p><strong>Decision Tree</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>peng_tree <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">|&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">|&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>peng_tree</code> specifies to fit for <code>classification</code> with the <code>rpart</code><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> as engine.</p>
</div>
</div>
</section>
<section id="split-and-fit" class="level2 smaller" data-number="4.3">
<h2 class="smaller anchored" data-number="4.3" data-anchor-id="split-and-fit"><span class="header-section-number">4.3</span> Split and fit</h2>
<p>For logistic regression and decision tree:</p>
<p>Split into test and training data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>penguins_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(penguins, <span class="at">prop =</span> <span class="fl">0.7</span>, <span class="at">strata =</span> sex)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>peng_train <span class="ot">&lt;-</span> <span class="fu">training</span>(penguins_split)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>peng_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(penguins_split)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>peng_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> <span class="fu">add_recipe</span>(peng_recipe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>. . .</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Logistic Regression</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>peng_logreg_fit <span class="ot">&lt;-</span> peng_workflow <span class="sc">|&gt;</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">add_model</span>(peng_logreg) <span class="sc">|&gt;</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">fit</span>(<span class="at">data =</span> peng_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>Decision Tree</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>peng_tree_fit <span class="ot">&lt;-</span> peng_workflow <span class="sc">|&gt;</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">add_model</span>(peng_tree) <span class="sc">|&gt;</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">fit</span>(<span class="at">data =</span> peng_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="look-at-fitted-logistic-regression" class="level2 smaller" data-number="4.4">
<h2 class="smaller anchored" data-number="4.4" data-anchor-id="look-at-fitted-logistic-regression"><span class="header-section-number">4.4</span> Look at fitted logistic regression</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>peng_logreg_fit <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 5
  term               estimate std.error statistic      p.value
  &lt;chr&gt;                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
1 (Intercept)       -90.4      16.7        -5.41  0.0000000632
2 speciesChinstrap   -6.06      1.90       -3.19  0.00142     
3 speciesGentoo      -8.65      3.49       -2.48  0.0132      
4 islandDream         0.752     1.15        0.656 0.512       
5 islandTorgersen     0.380     1.13        0.335 0.737       
6 bill_length_mm      0.532     0.150       3.56  0.000378    
7 bill_depth_mm       1.79      0.456       3.93  0.0000866   
8 flipper_length_mm   0.0552    0.0620      0.891 0.373       
9 body_mass_g         0.00693   0.00162     4.27  0.0000193   </code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<ul>
<li>What do the categorical predictors tell us? Which are signigficant?</li>
<li>What do the numerical predictors tell us? Which are signigficant?</li>
<li>Why is the coefficient for <code>body_mass_g</code> so small, but highly significant?</li>
</ul>
</div>
</div>
<p>. . .</p>
<p><strong>Categorical predictors:</strong> We have 3 <code>species</code>, 3 <code>island</code>. So, we see 4 new variables, 2 for <code>species</code> and 2 for <code>island</code> (the third is the reference category). Species are significant (p &lt; 0.05), but islands not.</p>
<p><strong>Numerical predictors:</strong> <code>flipper_length_mm</code> is insignificant, though its coefficient is larger than for <code>body_mass_g</code>. Reason: values of <code>body_mass_g</code> are larger than those of <code>flipper_length_mm</code>. Body mass differs by much more grams than flipper length differs by millimeters.</p>
</section>
<section id="what-is-a-decision-tree" class="level2 smaller" data-number="4.5">
<h2 class="smaller anchored" data-number="4.5" data-anchor-id="what-is-a-decision-tree"><span class="header-section-number">4.5</span> What is a decision tree?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>peng_tree_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: decision_tree()

── Preprocessor ────────────────────────────────────────────────────────────────
1 Recipe Step

• step_rm()

── Model ───────────────────────────────────────────────────────────────────────
n=234 (6 observations deleted due to missingness)

node), split, n, loss, yval, (yprob)
      * denotes terminal node

 1) root 234 117 female (0.50000000 0.50000000)  
   2) bill_length_mm&lt; 48.15 166  57 female (0.65662651 0.34337349)  
     4) bill_depth_mm&lt; 18.05 103  14 female (0.86407767 0.13592233)  
       8) body_mass_g&lt; 4987.5 88   4 female (0.95454545 0.04545455) *
       9) body_mass_g&gt;=4987.5 15   5 male (0.33333333 0.66666667) *
     5) bill_depth_mm&gt;=18.05 63  20 male (0.31746032 0.68253968)  
      10) body_mass_g&lt; 3875 29  10 female (0.65517241 0.34482759)  
        20) flipper_length_mm&lt; 190.5 18   3 female (0.83333333 0.16666667) *
        21) flipper_length_mm&gt;=190.5 11   4 male (0.36363636 0.63636364) *
      11) body_mass_g&gt;=3875 34   1 male (0.02941176 0.97058824) *
   3) bill_length_mm&gt;=48.15 68   8 male (0.11764706 0.88235294)  
     6) body_mass_g&lt; 5175 35   8 male (0.22857143 0.77142857)  
      12) bill_depth_mm&lt; 18 9   3 female (0.66666667 0.33333333) *
      13) bill_depth_mm&gt;=18 26   2 male (0.07692308 0.92307692) *
     7) body_mass_g&gt;=5175 33   0 male (0.00000000 1.00000000) *</code></pre>
</div>
</div>
<ul>
<li>A sequence of rules for yes/no decisions</li>
<li>Selects variables and thresholds which separate the data to predict (here <code>sex</code>) best</li>
<li>Further details are not the scope of this course</li>
</ul>
</section>
<section id="show-rules" class="level2 smaller" data-number="4.6">
<h2 class="smaller anchored" data-number="4.6" data-anchor-id="show-rules"><span class="header-section-number">4.6</span> Show rules</h2>
<p>We “dig out” the original fitted <code>rpart</code>-object from the <code>workflow</code>-object with <code>peng_tree_fit$fit$fit$fit</code> and plot it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.rules</span>(peng_tree_fit<span class="sc">$</span>fit<span class="sc">$</span>fit<span class="sc">$</span>fit, <span class="at">roundint=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ..y                                                                                                 
 0.05 when bill_length_mm &lt;  48 &amp; body_mass_g &lt;  4988 &amp; bill_depth_mm &lt;  18                           
 0.17 when bill_length_mm &lt;  48 &amp; body_mass_g &lt;  3875 &amp; bill_depth_mm &gt;= 18 &amp; flipper_length_mm &lt;  191
 0.33 when bill_length_mm &gt;= 48 &amp; body_mass_g &lt;  5175 &amp; bill_depth_mm &lt;  18                           
 0.64 when bill_length_mm &lt;  48 &amp; body_mass_g &lt;  3875 &amp; bill_depth_mm &gt;= 18 &amp; flipper_length_mm &gt;= 191
 0.67 when bill_length_mm &lt;  48 &amp; body_mass_g &gt;= 4988 &amp; bill_depth_mm &lt;  18                           
 0.92 when bill_length_mm &gt;= 48 &amp; body_mass_g &lt;  5175 &amp; bill_depth_mm &gt;= 18                           
 0.97 when bill_length_mm &lt;  48 &amp; body_mass_g &gt;= 3875 &amp; bill_depth_mm &gt;= 18                           
 1.00 when bill_length_mm &gt;= 48 &amp; body_mass_g &gt;= 5175                                                 </code></pre>
</div>
</div>
<ul>
<li>The first three rules would predict <code>female</code> for all observations</li>
<li>The last five rules would predict <code>male</code> for all observations</li>
</ul>
<p>The order of <code>male</code> and <code>female</code> is because <code>sex</code> is a factor with the first level <code>female</code> and the second level <code>male</code>. The probabilities in front of the rule-text are for the second level: <code>male</code>.</p>
</section>
<section id="visualize-tree" class="level2 smaller" data-number="4.7">
<h2 class="smaller anchored" data-number="4.7" data-anchor-id="visualize-tree"><span class="header-section-number">4.7</span> Visualize tree</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(peng_tree_fit<span class="sc">$</span>fit<span class="sc">$</span>fit<span class="sc">$</span>fit, </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">roundint=</span><span class="cn">FALSE</span>, <span class="at">tweak=</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W09_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>How to read?</p>
<ul>
<li>The percentage is the fraction of the total cases in this group</li>
<li>The probability-number is the fraction of observations which are male in the group</li>
<li><code>male</code> of <code>female</code> and color would match the predicted outcome at this decision node</li>
</ul>
</section>
<section id="make-predictions-for-test-data" class="level2 smaller" data-number="4.8">
<h2 class="smaller anchored" data-number="4.8" data-anchor-id="make-predictions-for-test-data"><span class="header-section-number">4.8</span> Make predictions for test data</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>peng_logreg_pred <span class="ot">&lt;-</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">predict</span>(peng_logreg_fit, peng_test) <span class="sc">|&gt;</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">bind_cols</span>(peng_test) </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>peng_logreg_pred <span class="sc">|&gt;</span> </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">conf_mat</span>(<span class="at">truth =</span> sex, <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction female male
    female     46   10
    male        2   41</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>peng_tree_pred <span class="ot">&lt;-</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">predict</span>(peng_tree_fit, peng_test) <span class="sc">|&gt;</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">bind_cols</span>(peng_test)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>peng_tree_pred <span class="sc">|&gt;</span> </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">conf_mat</span>(<span class="at">truth =</span> sex, <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction female male
    female     43   12
    male        5   39</code></pre>
</div>
</div>
</div>
</div>
<ul>
<li>The logistic regression has more correct predictions.</li>
<li><span style="color:red;">Warning:</span> The function <code>conf_mat</code> (from <code>yardstick</code> of <code>tidymodels</code>) shows the transposed confusion matrix compared with <a href="https://en.wikipedia.org/wiki/Confusion_matrix">Wikipedia:Confusion Matrix</a>. In <code>conf_mat</code>, the <em>true conditions</em> are in columns. The wikipedia convention is that columns are the <em>predicted conditions</em>.</li>
</ul>
</section>
</section>
<section id="regression-compare-linear-regression-and-decision-tree" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Regression: Compare linear regression and decision tree</h1>
<section id="purpose-of-the-section-1" class="level2 smaller" data-number="5.1">
<h2 class="smaller anchored" data-number="5.1" data-anchor-id="purpose-of-the-section-1"><span class="header-section-number">5.1</span> Purpose of the section</h2>
<ul>
<li>Go again through the modeling workflow (with <code>tidymodels</code>) and see that large parts are identical</li>
<li>Look again at the coefficients of a linear model</li>
<li>See how the decision tree looks like for a regression problem</li>
<li>Compare the two most common performance measures for regression models: Root Mean Squared Error (RMSE) and R-squared</li>
</ul>
</section>
<section id="specify-recipe-and-models-1" class="level2 smaller" data-number="5.2">
<h2 class="smaller anchored" data-number="5.2" data-anchor-id="specify-recipe-and-models-1"><span class="header-section-number">5.2</span> Specify recipe and models</h2>
<ul>
<li>We specify a recipe to predict <code>body_mass_g</code> with all available variables in <code>penguins</code> and put it in a workflow
<ul>
<li>Typically, more pre-processing steps are specified here, but we are mostly fine</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>peng_recipe2 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(body_mass_g <span class="sc">~</span> ., <span class="at">data =</span> penguins) <span class="sc">|&gt;</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_rm</span>(year)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>peng_workflow2 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">add_recipe</span>(peng_recipe2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can re-use the split and the training and test set.</p>
<p>. . .</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Linear Regression</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>peng_linreg <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">set_engine</span>(<span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>Decision Tree</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>peng_regtree <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>() <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">|&gt;</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="fit-regression-models" class="level2 smaller" data-number="5.3">
<h2 class="smaller anchored" data-number="5.3" data-anchor-id="fit-regression-models"><span class="header-section-number">5.3</span> Fit Regression Models</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Linear Regression</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>peng_linreg_fit <span class="ot">&lt;-</span> peng_workflow2 <span class="sc">|&gt;</span> </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">add_model</span>(peng_linreg) <span class="sc">|&gt;</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">fit</span>(<span class="at">data =</span> peng_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>Decision Tree</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>peng_regtree_fit <span class="ot">&lt;-</span> peng_workflow2 <span class="sc">|&gt;</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">add_model</span>(peng_regtree) <span class="sc">|&gt;</span> </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">fit</span>(<span class="at">data =</span> peng_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="look-at-fitted-linear-regression" class="level2 smaller" data-number="5.4">
<h2 class="smaller anchored" data-number="5.4" data-anchor-id="look-at-fitted-linear-regression"><span class="header-section-number">5.4</span> Look at fitted linear regression</h2>
<div class="columns">
<div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>peng_linreg_fit <span class="sc">|&gt;</span> <span class="fu">tidy</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 5
  term              estimate std.error statistic  p.value
  &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)         -829.     701.      -1.18  2.38e- 1
2 speciesChinstrap    -268.     109.      -2.47  1.44e- 2
3 speciesGentoo       1010.     164.       6.15  3.52e- 9
4 islandDream          -14.5     70.0     -0.208 8.36e- 1
5 islandTorgersen      -21.4     75.7     -0.283 7.77e- 1
6 bill_length_mm        19.8      8.55     2.32  2.13e- 2
7 bill_depth_mm         53.7     23.9      2.25  2.56e- 2
8 flipper_length_mm     13.6      3.54     3.84  1.58e- 4
9 sexmale              393.      58.5      6.71  1.57e-10</code></pre>
</div>
</div>
</div><div class="column" style="width:40%;">
<ul>
<li>What do the categorical predictors tell us? Which are signigficant?</li>
<li>What do the numerical predictors tell us? Which are signigficant?</li>
</ul>
</div>
</div>
<p>. . .</p>
<p><strong>Categorical predictors:</strong> We have 3 <code>species</code>, 3 <code>island</code> and 2 <code>sex</code>. So, we see 5 new variables. Species and sex are significant, but islands not.</p>
<p><strong>Numerical predictors:</strong> All 3 are significant.</p>
</section>
<section id="show-rules-1" class="level2 smaller" data-number="5.5">
<h2 class="smaller anchored" data-number="5.5" data-anchor-id="show-rules-1"><span class="header-section-number">5.5</span> Show rules</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.rules</span>(peng_regtree_fit<span class="sc">$</span>fit<span class="sc">$</span>fit<span class="sc">$</span>fit, <span class="at">roundint=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ..y                                                    
 3418 when species is Adelie or Chinstrap &amp; sex is female
 3961 when species is Adelie or Chinstrap &amp; sex is   male
 4693 when species is              Gentoo &amp; sex is female
 5474 when species is              Gentoo &amp; sex is   male</code></pre>
</div>
</div>
<ul>
<li>For each terminal node a certain value is predicted (the mean of the remaining penguins)</li>
</ul>
</section>
<section id="visualize-tree-1" class="level2 smaller" data-number="5.6">
<h2 class="smaller anchored" data-number="5.6" data-anchor-id="visualize-tree-1"><span class="header-section-number">5.6</span> Visualize tree</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(peng_regtree_fit<span class="sc">$</span>fit<span class="sc">$</span>fit<span class="sc">$</span>fit, </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">roundint=</span><span class="cn">FALSE</span>, <span class="at">tweak=</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W09_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>How to read?</p>
<ul>
<li>The percentage is the fraction of the total cases in this group</li>
<li>The number is the predicted outcome (mean body mass) at this decision node</li>
</ul>
</section>
<section id="make-predictions-for-test-data-1" class="level2 smaller" data-number="5.7">
<h2 class="smaller anchored" data-number="5.7" data-anchor-id="make-predictions-for-test-data-1"><span class="header-section-number">5.7</span> Make predictions for test data</h2>
<div class="columns">
<div class="column" style="width:65%;">
<p><strong>Linear Regression</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>peng_linreg_pred <span class="ot">&lt;-</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">predict</span>(peng_linreg_fit, peng_test) <span class="sc">|&gt;</span> </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">bind_cols</span>(peng_test) </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>peng_linreg_pred <span class="sc">|&gt;</span> </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">select</span>(.pred, body_mass_g, <span class="fu">everything</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">slice</span>(<span class="dv">10</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)) <span class="co"># show selected rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 9
   .pred body_mass_g species   island    bill_length_mm bill_depth_mm
   &lt;dbl&gt;       &lt;int&gt; &lt;fct&gt;     &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;
 1 3349.        3700 Adelie    Torgersen           36.6          17.8
 2 3979.        3950 Adelie    Dream               38.8          20  
 3 3902.        3800 Adelie    Dream               36.3          19.5
 4 4106.        3875 Adelie    Torgersen           41.4          18.5
 5 3499.        3400 Adelie    Dream               40.2          17.1
 6 4597.        4150 Gentoo    Biscoe              42            13.5
 7 4688.        4200 Gentoo    Biscoe              45.5          13.9
 8 4929.        4850 Gentoo    Biscoe              48.5          15  
 9 4014.        4150 Chinstrap Dream               52            19  
10 4108.        4050 Chinstrap Dream               50.7          19.7
# ℹ 3 more variables: flipper_length_mm &lt;int&gt;, sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
</div>
</div><div class="column" style="width:35%;">
<p><strong>Decision Tree</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>peng_regtree_pred <span class="ot">&lt;-</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">predict</span>(peng_regtree_fit, peng_test) <span class="sc">|&gt;</span> </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">bind_cols</span>(peng_test)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>peng_regtree_pred <span class="sc">|&gt;</span> </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">select</span>(.pred, body_mass_g, species, sex) <span class="sc">|&gt;</span> </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">slice</span>(<span class="dv">10</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)) <span class="co"># show same selected rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   .pred body_mass_g species   sex   
   &lt;dbl&gt;       &lt;int&gt; &lt;fct&gt;     &lt;fct&gt; 
 1 3418         3700 Adelie    female
 2 3961.        3950 Adelie    male  
 3 3961.        3800 Adelie    male  
 4 3961.        3875 Adelie    male  
 5 3418         3400 Adelie    female
 6 4693.        4150 Gentoo    female
 7 4693.        4200 Gentoo    female
 8 4693.        4850 Gentoo    female
 9 3961.        4150 Chinstrap male  
10 3961.        4050 Chinstrap male  </code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="regression-performance-evaluation" class="level2 smaller" data-number="5.8">
<h2 class="smaller anchored" data-number="5.8" data-anchor-id="regression-performance-evaluation"><span class="header-section-number">5.8</span> Regression Performance Evaluation</h2>
<p><span style="color:blue;"><strong>R-squared</strong></span>: Percentage of variability in <code>body_mass_g</code> explained by the model</p>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Linear Regression</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsq</span>(peng_linreg_pred, </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">truth =</span> body_mass_g, <span class="at">estimate =</span> .pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rsq     standard       0.861</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>Decision Tree</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsq</span>(peng_regtree_pred, </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">truth =</span> body_mass_g, <span class="at">estimate =</span> .pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rsq     standard       0.806</code></pre>
</div>
</div>
</div>
</div>
<p><span style="color:blue;"><strong>Root Mean Squared Error (RMSE)</strong>:</span> <span class="math inline">\(\text{RMSE} = \sqrt{\frac{1}{n}\sum_{i = 1}^n (y_i - \hat{y}_i)^2}\)</span><br>
where <span class="math inline">\(\hat{y}_i\)</span> is the predicted value and <span class="math inline">\(y_i\)</span> the true value. (The name RMSE is descriptive.)</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse</span>(peng_linreg_pred, </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">truth =</span> body_mass_g, </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">estimate =</span> .pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard        290.</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rmse</span>(peng_regtree_pred, </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">truth =</span> body_mass_g, </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">estimate =</span> .pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard        337.</code></pre>
</div>
</div>
</div>
</div>
<p>Which model is better in prediction? <span class="fragment"><strong>Linear regression.</strong> The R-squared is higher.</span></p>
</section>
<section id="what-rmse-is-better" class="level2 smaller" data-number="5.9">
<h2 class="smaller anchored" data-number="5.9" data-anchor-id="what-rmse-is-better"><span class="header-section-number">5.9</span> What RMSE is better?</h2>
<p>. . .</p>
<p><strong>Lower. The lower the error, the better the model’s prediction.</strong></p>
<p>It is the other way round than R-squared! Do not confuse them.</p>
<p>. . .</p>
<p>Notes:</p>
<ul>
<li>The common method to fit a linear model is the <em>ordinary least squares</em> (OLS) method</li>
<li>That means the fitted parameters should deliver the lowest possible sum of squared errors (SSE) between predicted and observed values.</li>
<li>Minimizing the sum of squared errors (SSE) is identical to minimizing the mean of squared errors (MSE) because it only adds the factor <span class="math inline">\(1/n\)</span>.</li>
<li>Minimizing the mean of squared errors (MSE) is identical to minimizing the root mean of squared errors (RMSE) because the square root is strictly monotone function.</li>
</ul>
<p>Conclusion: RMSE can be seen as a definition of the OLS optimization goal.</p>
</section>
<section id="interpreting-rmse" class="level2 smaller" data-number="5.10">
<h2 class="smaller anchored" data-number="5.10" data-anchor-id="interpreting-rmse"><span class="header-section-number">5.10</span> Interpreting RMSE</h2>
<p>In contrast to R-squared, RMSE can only be interpreted with knowledge about the range and of the response variable! It also has the same unit (grams for <code>body_mass_g</code>).</p>
<div class="cell" data-output-location="column">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>peng_test <span class="sc">|&gt;</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>body_mass_g, <span class="at">fill =</span> species)) <span class="sc">+</span> </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">50</span>) <span class="sc">+</span> </span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W09_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-output-location="column">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>peng_linreg_pred <span class="sc">|&gt;</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>.pred, <span class="at">fill =</span> species)) <span class="sc">+</span> </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">50</span>) <span class="sc">+</span> </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 5 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W09_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-output-location="column">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>peng_regtree_pred <span class="sc">|&gt;</span> </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>.pred, <span class="at">fill =</span> species)) <span class="sc">+</span> </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">50</span>) <span class="sc">+</span> </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W09_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The RMSE shows many grams predicted values deviate from the true value on average. (Taking the squaring of differences and root of the average into account.)</p>
</section>
</section>
<section id="overfitting-with-decision-trees" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Overfitting with decision trees</h1>
<section id="compare-training-and-test-data" class="level2 smaller" data-number="6.1">
<h2 class="smaller anchored" data-number="6.1" data-anchor-id="compare-training-and-test-data"><span class="header-section-number">6.1</span> Compare training and test data</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Linear Regression</strong> Predict with test data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(peng_linreg_fit, peng_test) <span class="sc">|&gt;</span> <span class="fu">bind_cols</span>(peng_test) <span class="sc">|&gt;</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">metrics</span>(<span class="at">truth =</span> body_mass_g, <span class="at">estimate =</span> .pred) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard     290.   
2 rsq     standard       0.861</code></pre>
</div>
</div>
<p>Predict with training data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(peng_linreg_fit, peng_train) <span class="sc">|&gt;</span> <span class="fu">bind_cols</span>(peng_train) <span class="sc">|&gt;</span> </span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">metrics</span>(<span class="at">truth =</span> body_mass_g, <span class="at">estimate =</span> .pred) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard     283.   
2 rsq     standard       0.880</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>Decision Tree</strong> Predict with test data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(peng_regtree_fit, peng_test) <span class="sc">|&gt;</span> <span class="fu">bind_cols</span>(peng_test) <span class="sc">|&gt;</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">metrics</span>(<span class="at">truth =</span> body_mass_g, <span class="at">estimate =</span> .pred) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard     337.   
2 rsq     standard       0.806</code></pre>
</div>
</div>
<p>Predict with training data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(peng_regtree_fit, peng_train) <span class="sc">|&gt;</span> <span class="fu">bind_cols</span>(peng_train) <span class="sc">|&gt;</span> </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">metrics</span>(<span class="at">truth =</span> body_mass_g, <span class="at">estimate =</span> .pred) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard     309.   
2 rsq     standard       0.857</code></pre>
</div>
</div>
</div>
</div>
<p>Where is the prediction better? (Lower RMSE, higher R-squared)</p>
<p>. . .</p>
<p>Performance is better for training data (compare values to testing data of the same model). Why? It was used to fit. The model is optimized to predict the training data.</p>
</section>
<section id="make-a-deeper-tree" class="level2 smaller" data-number="6.2">
<h2 class="smaller anchored" data-number="6.2" data-anchor-id="make-a-deeper-tree"><span class="header-section-number">6.2</span> Make a deeper tree</h2>
<ul>
<li>In <code>decision_tree()</code> we can set the maximal depth of the tree to 30.<br>
</li>
<li>The trees we had before were also automatically <em>pruned</em> by sensible defaults.<br>
</li>
<li>By setting the cost complexity parameter to -1 we avoid pruning.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>peng_regtree_deep <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a> <span class="at">cost_complexity =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a> <span class="at">tree_depth =</span> <span class="dv">30</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">|&gt;</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>peng_regtree_deep_fit <span class="ot">&lt;-</span> peng_workflow2 <span class="sc">|&gt;</span> <span class="fu">add_model</span>(peng_regtree_deep) <span class="sc">|&gt;</span> </span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">fit</span>(<span class="at">data =</span> peng_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-deep-tree" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="the-deep-tree"><span class="header-section-number">6.3</span> The deep tree</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(peng_regtree_deep_fit<span class="sc">$</span>fit<span class="sc">$</span>fit<span class="sc">$</span>fit, </span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">roundint=</span><span class="cn">FALSE</span>, <span class="at">tweak=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W09_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="compare-pruned-and-deep-tree" class="level2 smaller" data-number="6.4">
<h2 class="smaller anchored" data-number="6.4" data-anchor-id="compare-pruned-and-deep-tree"><span class="header-section-number">6.4</span> Compare pruned and deep tree</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Pruned decision tree</strong></p>
<p>Predict with <strong>training data</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>peng_regtree_fit <span class="sc">|&gt;</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">predict</span>(<span class="at">new_data =</span> peng_train) <span class="sc">|&gt;</span> <span class="fu">bind_cols</span>(peng_train) <span class="sc">|&gt;</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">metrics</span>(<span class="at">truth =</span> body_mass_g, <span class="at">estimate =</span> .pred) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard     309.   
2 rsq     standard       0.857</code></pre>
</div>
</div>
<p>Predict with <strong>testing data</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>peng_regtree_fit <span class="sc">|&gt;</span> </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">predict</span>(peng_test) <span class="sc">|&gt;</span> <span class="fu">bind_cols</span>(peng_test) <span class="sc">|&gt;</span> </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">metrics</span>(<span class="at">truth =</span> body_mass_g, <span class="at">estimate =</span> .pred) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard     337.   
2 rsq     standard       0.806</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>Deep decision tree</strong></p>
<p>Predict with <strong>training data</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>peng_regtree_deep_fit <span class="sc">|&gt;</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">predict</span>(<span class="at">new_data =</span> peng_train) <span class="sc">|&gt;</span> <span class="fu">bind_cols</span>(peng_train) <span class="sc">|&gt;</span> </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">metrics</span>(<span class="at">truth =</span> body_mass_g, <span class="at">estimate =</span> .pred) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard     247.   
2 rsq     standard       0.908</code></pre>
</div>
</div>
<p>Predict with <strong>testing data</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>peng_regtree_deep_fit <span class="sc">|&gt;</span> </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">predict</span>(peng_test) <span class="sc">|&gt;</span> <span class="fu">bind_cols</span>(peng_test) <span class="sc">|&gt;</span> </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">metrics</span>(<span class="at">truth =</span> body_mass_g, <span class="at">estimate =</span> .pred) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard     333.   
2 rsq     standard       0.808</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="more-in-an-r-script" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="more-in-an-r-script"><span class="header-section-number">6.5</span> More in an R-script</h2>
<ul>
<li><p>Overfitting in spam predicton models.</p></li>
<li><p>From decision trees to random forrests.</p></li>
</ul>
<p>Move to the <a href="https://raw.githubusercontent.com/CU-F24-MDSSB-01-Concepts-Tools/Website/refs/heads/main/emails_decision_tree_overfitting_randomforrest.r">script</a>.</p>
</section>
</section>
<section id="what-do-we-mean-by-model-how-to-be-specific" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> What do we mean by “model”? How to be specific</h1>
<section id="model-in-statistical-learning" class="level2 smaller" data-number="7.1">
<h2 class="smaller anchored" data-number="7.1" data-anchor-id="model-in-statistical-learning"><span class="header-section-number">7.1</span> “Model” in Statistical Learning</h2>
<p>We already had the difference between <em>variable-based</em> and <em>agent-based</em> models in earlier lectures.</p>
<p>But even in the variable-based model setting of <strong>statistical learning</strong>, the term <em>model</em> can be more or less abstract:</p>
<ol type="1">
<li>Very general: <span class="math inline">\(Y = f(X_1, \dots, X_m) + \varepsilon\)</span> where <span class="math inline">\(Y\)</span> is the response variable and <span class="math inline">\(X_i\)</span> are features which we put in our <strong>model</strong>: the abstract and unknown function <span class="math inline">\(f\)</span>.<br>
<span class="math inline">\(\varepsilon\)</span> is the <em>error</em> which we can never explain usually do not know.</li>
<li>More specific: The <strong>model</strong> <span class="math inline">\(f\)</span> could already be of a specific type, like <em>logistic regression</em>, a <em>decision tree</em> or other functional forms. As this need not be the <em>real</em> function we may call it <em>assumed model</em> <span class="math inline">\(\hat f\)</span> For example a linear model <span class="math inline">\(\hat f(X_1, \dots, X_m) = \beta_0 + \beta_1 X_1 + \dots + \beta_m X_m + \varepsilon\)</span>. Now, the model has specified parameters which values are unknown.</li>
</ol>
</section>
<section id="more-specific-fitted-model" class="level2 smaller" data-number="7.2">
<h2 class="smaller anchored" data-number="7.2" data-anchor-id="more-specific-fitted-model"><span class="header-section-number">7.2</span> More specific: Fitted model</h2>
<ol start="3" type="1">
<li>Fitted model: When we have a data set with values for <span class="math inline">\(Y, X_1, \dots, X_m\)</span> we can fit values for the parameters <span class="math inline">\(\hat\beta_0, \dots, \hat\beta_m\)</span> to the data. This is the <em>fitted model</em> <span class="math inline">\(\hat f\)</span>. This is called parameter estimation: We estimate <span class="math inline">\(\hat\beta_0, \dots, \hat\beta_m\)</span> with the hope that they match the <em>real</em> values <span class="math inline">\(\beta_0, \dots, \beta_m\)</span> and that the linear model <span class="math inline">\(\hat f\)</span> matches the <em>real</em> function <span class="math inline">\(f\)</span>.</li>
<li>Now we could specify further to fit a specific parameterized model with a specific algorithm, and a specific set of hyperparameters, and maybe more …</li>
</ol>
<p>Sometimes model means only a certain aspect of all these, for example the <em>formula</em> like <code>sex ~ bill_length_mm + bill_depth_mm + flipper_length_mm + body_mass_g + species + island</code></p>
<p>. . .</p>
<p><span style="color:blue;">Take away:</span> “Model” can mean things with very different granularity. That is OK because they are all related and all fit the definition of being a <strong>simplified representation of reality</strong>.</p>
<p><span style="color:blue;"><strong>Be prepared to specify what you mean when you are talking about a model.</strong></span></p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Of course, you can also do it in your own way without packages.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>This a one-sided hypothesis test because we are looking for extremely lower rates not also extremely higher rates. We do one-sided test if we know the direction of interest, here “low” and “lower” rates.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>From the American Statistical Association (ASA) 2016<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>From the American Statistical Association (ASA) 2019<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p><code>rpart</code> is a package for <em>recursive partitioning and regression trees</em>. Different decision tree procedures are subsumed as <strong>classification and regression trees (CART)</strong><a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>The details of this go beyond the scope of this course.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>