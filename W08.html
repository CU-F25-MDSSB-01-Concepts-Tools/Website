<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jan Lorenz">

<title>W#08: Predicting Categorical Variables, Logistic Regression, Classification Problems – Data Science Concepts / Data Science Tools</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d90c30c96bad360bae691b5c26d18f86.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed slimcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Data Science Concepts / Data Science Tools</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">W#08: Predicting Categorical Variables, Logistic Regression, Classification Problems</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Schedule</strong></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./late.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Onboarding Late-arriving</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./homework.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework Projects</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Final Project</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./help.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Help Project Work</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./literature.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Literature</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link active" data-scroll-target="#preliminaries"><span class="header-section-number">0.1</span> Preliminaries</a></li>
  <li><a href="#predicting-categorical-data" id="toc-predicting-categorical-data" class="nav-link" data-scroll-target="#predicting-categorical-data"><span class="header-section-number">1</span> Predicting Categorical Data</a>
  <ul class="collapse">
  <li><a href="#what-if-response-is-binary" id="toc-what-if-response-is-binary" class="nav-link" data-scroll-target="#what-if-response-is-binary"><span class="header-section-number">1.1</span> What if response is binary?</a></li>
  <li><a href="#multinomial-response-variable" id="toc-multinomial-response-variable" class="nav-link" data-scroll-target="#multinomial-response-variable"><span class="header-section-number">1.2</span> Multinomial response variable?</a></li>
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables"><span class="header-section-number">1.3</span> Variables</a></li>
  <li><a href="#data-exploration" id="toc-data-exploration" class="nav-link" data-scroll-target="#data-exploration"><span class="header-section-number">1.4</span> Data exploration</a></li>
  <li><a href="#linear-models" id="toc-linear-models" class="nav-link" data-scroll-target="#linear-models"><span class="header-section-number">1.5</span> Linear models?</a></li>
  <li><a href="#a-penguins-example---predict-sex" id="toc-a-penguins-example---predict-sex" class="nav-link" data-scroll-target="#a-penguins-example---predict-sex"><span class="header-section-number">1.6</span> A penguins example - predict sex</a></li>
  <li><a href="#a-probabilistic-concept" id="toc-a-probabilistic-concept" class="nav-link" data-scroll-target="#a-probabilistic-concept"><span class="header-section-number">1.7</span> A probabilistic concept</a></li>
  </ul></li>
  <li><a href="#generalized-linear-models" id="toc-generalized-linear-models" class="nav-link" data-scroll-target="#generalized-linear-models"><span class="header-section-number">2</span> Generalized linear models</a>
  <ul class="collapse">
  <li><a href="#characterising-glms" id="toc-characterising-glms" class="nav-link" data-scroll-target="#characterising-glms"><span class="header-section-number">2.1</span> Characterising GLMs</a></li>
  </ul></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression"><span class="header-section-number">3</span> Logistic regression</a>
  <ul class="collapse">
  <li><a href="#logistic-regression-1" id="toc-logistic-regression-1" class="nav-link" data-scroll-target="#logistic-regression-1"><span class="header-section-number">3.1</span> Logistic regression</a></li>
  <li><a href="#properties-of-the-logit" id="toc-properties-of-the-logit" class="nav-link" data-scroll-target="#properties-of-the-logit"><span class="header-section-number">3.2</span> Properties of the logit</a></li>
  <li><a href="#logit-and-logistic-function" id="toc-logit-and-logistic-function" class="nav-link" data-scroll-target="#logit-and-logistic-function"><span class="header-section-number">3.3</span> Logit and <span style="color:red;">logistic</span> function</a></li>
  <li><a href="#the-logistic-regression-model" id="toc-the-logistic-regression-model" class="nav-link" data-scroll-target="#the-logistic-regression-model"><span class="header-section-number">3.4</span> The logistic regression model</a></li>
  <li><a href="#modeling-spam" id="toc-modeling-spam" class="nav-link" data-scroll-target="#modeling-spam"><span class="header-section-number">3.5</span> Modeling spam</a></li>
  <li><a href="#spam-model" id="toc-spam-model" class="nav-link" data-scroll-target="#spam-model"><span class="header-section-number">3.6</span> Spam model</a></li>
  <li><a href="#predicted-probability-examples" id="toc-predicted-probability-examples" class="nav-link" data-scroll-target="#predicted-probability-examples"><span class="header-section-number">3.7</span> Predicted probability: Examples</a></li>
  <li><a href="#predicted-probability" id="toc-predicted-probability" class="nav-link" data-scroll-target="#predicted-probability"><span class="header-section-number">3.8</span> Predicted probability</a></li>
  <li><a href="#interpretation-of-coefficients" id="toc-interpretation-of-coefficients" class="nav-link" data-scroll-target="#interpretation-of-coefficients"><span class="header-section-number">3.9</span> Interpretation of coefficients</a></li>
  <li><a href="#penguins-example" id="toc-penguins-example" class="nav-link" data-scroll-target="#penguins-example"><span class="header-section-number">3.10</span> Penguins example</a></li>
  <li><a href="#summarizing-the-idea-of-logistic-regression" id="toc-summarizing-the-idea-of-logistic-regression" class="nav-link" data-scroll-target="#summarizing-the-idea-of-logistic-regression"><span class="header-section-number">3.11</span> Summarizing the Idea of Logistic Regression</a></li>
  </ul></li>
  <li><a href="#sensitivity-and-specificity" id="toc-sensitivity-and-specificity" class="nav-link" data-scroll-target="#sensitivity-and-specificity"><span class="header-section-number">4</span> Sensitivity and specificity</a>
  <ul class="collapse">
  <li><a href="#false-positive-and-negative" id="toc-false-positive-and-negative" class="nav-link" data-scroll-target="#false-positive-and-negative"><span class="header-section-number">4.1</span> False positive and negative</a></li>
  <li><a href="#confusion-matrix" id="toc-confusion-matrix" class="nav-link" data-scroll-target="#confusion-matrix"><span class="header-section-number">4.2</span> Confusion matrix</a></li>
  <li><a href="#sensitivity-and-specificity-1" id="toc-sensitivity-and-specificity-1" class="nav-link" data-scroll-target="#sensitivity-and-specificity-1"><span class="header-section-number">4.3</span> Sensitivity and specificity</a></li>
  <li><a href="#covid-19-tests" id="toc-covid-19-tests" class="nav-link" data-scroll-target="#covid-19-tests"><span class="header-section-number">4.4</span> COVID-19 tests</a></li>
  <li><a href="#another-view" id="toc-another-view" class="nav-link" data-scroll-target="#another-view"><span class="header-section-number">4.5</span> Another view</a></li>
  </ul></li>
  <li><a href="#prediction" id="toc-prediction" class="nav-link" data-scroll-target="#prediction"><span class="header-section-number">5</span> Prediction</a>
  <ul class="collapse">
  <li><a href="#prediction-vs.-explanation" id="toc-prediction-vs.-explanation" class="nav-link" data-scroll-target="#prediction-vs.-explanation"><span class="header-section-number">5.1</span> Prediction vs.&nbsp;Explanation</a></li>
  <li><a href="#prediction-example-building-a-spam-filter" id="toc-prediction-example-building-a-spam-filter" class="nav-link" data-scroll-target="#prediction-example-building-a-spam-filter"><span class="header-section-number">5.2</span> Prediction Example: Building a spam filter</a></li>
  <li><a href="#emails-use-all-predictors" id="toc-emails-use-all-predictors" class="nav-link" data-scroll-target="#emails-use-all-predictors"><span class="header-section-number">5.3</span> Emails: Use all predictors</a></li>
  <li><a href="#the-prediction-task" id="toc-the-prediction-task" class="nav-link" data-scroll-target="#the-prediction-task"><span class="header-section-number">5.4</span> The prediction task</a></li>
  <li><a href="#balance-over--and-underfitting" id="toc-balance-over--and-underfitting" class="nav-link" data-scroll-target="#balance-over--and-underfitting"><span class="header-section-number">5.5</span> Balance Over- and Underfitting</a></li>
  <li><a href="#spending-our-data" id="toc-spending-our-data" class="nav-link" data-scroll-target="#spending-our-data"><span class="header-section-number">5.6</span> Spending our data</a></li>
  </ul></li>
  <li><a href="#splitting-data" id="toc-splitting-data" class="nav-link" data-scroll-target="#splitting-data"><span class="header-section-number">6</span> Splitting Data</a>
  <ul class="collapse">
  <li><a href="#splitting-data-1" id="toc-splitting-data-1" class="nav-link" data-scroll-target="#splitting-data-1"><span class="header-section-number">6.1</span> Splitting data</a></li>
  <li><a href="#performing-the-split" id="toc-performing-the-split" class="nav-link" data-scroll-target="#performing-the-split"><span class="header-section-number">6.2</span> Performing the split</a></li>
  <li><a href="#peek-at-the-split" id="toc-peek-at-the-split" class="nav-link" data-scroll-target="#peek-at-the-split"><span class="header-section-number">6.3</span> Peek at the split</a></li>
  </ul></li>
  <li><a href="#workflow-of-predictive-modeling" id="toc-workflow-of-predictive-modeling" class="nav-link" data-scroll-target="#workflow-of-predictive-modeling"><span class="header-section-number">7</span> Workflow of Predictive Modeling</a>
  <ul class="collapse">
  <li><a href="#fit-a-model-to-the-training-dataset" id="toc-fit-a-model-to-the-training-dataset" class="nav-link" data-scroll-target="#fit-a-model-to-the-training-dataset"><span class="header-section-number">7.1</span> Fit a model to the training dataset</a></li>
  <li><a href="#look-at-categorical-predictors" id="toc-look-at-categorical-predictors" class="nav-link" data-scroll-target="#look-at-categorical-predictors"><span class="header-section-number">7.2</span> Look at categorical predictors</a></li>
  <li><a href="#counting-cases" id="toc-counting-cases" class="nav-link" data-scroll-target="#counting-cases"><span class="header-section-number">7.3</span> Counting cases</a></li>
  <li><a href="#look-at-numerical-variables" id="toc-look-at-numerical-variables" class="nav-link" data-scroll-target="#look-at-numerical-variables"><span class="header-section-number">7.4</span> Look at numerical variables</a></li>
  <li><a href="#fit-a-model-to-the-training-dataset-1" id="toc-fit-a-model-to-the-training-dataset-1" class="nav-link" data-scroll-target="#fit-a-model-to-the-training-dataset-1"><span class="header-section-number">7.5</span> Fit a model to the training dataset</a></li>
  <li><a href="#predict-with-the-testing-dataset" id="toc-predict-with-the-testing-dataset" class="nav-link" data-scroll-target="#predict-with-the-testing-dataset"><span class="header-section-number">7.6</span> Predict with the testing dataset</a></li>
  <li><a href="#relate-back-to-the-model-concept" id="toc-relate-back-to-the-model-concept" class="nav-link" data-scroll-target="#relate-back-to-the-model-concept"><span class="header-section-number">7.7</span> Relate back to the model concept</a></li>
  <li><a href="#another-look" id="toc-another-look" class="nav-link" data-scroll-target="#another-look"><span class="header-section-number">7.8</span> Another look</a></li>
  <li><a href="#evaluate-the-performance" id="toc-evaluate-the-performance" class="nav-link" data-scroll-target="#evaluate-the-performance"><span class="header-section-number">7.9</span> Evaluate the performance</a></li>
  <li><a href="#evaluate-the-performance-1" id="toc-evaluate-the-performance-1" class="nav-link" data-scroll-target="#evaluate-the-performance-1"><span class="header-section-number">7.10</span> Evaluate the performance</a></li>
  </ul></li>
  <li><a href="#feature-engineering" id="toc-feature-engineering" class="nav-link" data-scroll-target="#feature-engineering"><span class="header-section-number">8</span> Feature engineering</a>
  <ul class="collapse">
  <li><a href="#feature-engineering-1" id="toc-feature-engineering-1" class="nav-link" data-scroll-target="#feature-engineering-1"><span class="header-section-number">8.1</span> Feature engineering</a></li>
  <li><a href="#modeling-workflow-revisited" id="toc-modeling-workflow-revisited" class="nav-link" data-scroll-target="#modeling-workflow-revisited"><span class="header-section-number">8.2</span> Modeling workflow, revisited</a></li>
  </ul></li>
  <li><a href="#recipes" id="toc-recipes" class="nav-link" data-scroll-target="#recipes"><span class="header-section-number">9</span> Recipes</a>
  <ul class="collapse">
  <li><a href="#initiate-a-recipe" id="toc-initiate-a-recipe" class="nav-link" data-scroll-target="#initiate-a-recipe"><span class="header-section-number">9.1</span> Initiate a recipe</a></li>
  <li><a href="#remove-certain-variables" id="toc-remove-certain-variables" class="nav-link" data-scroll-target="#remove-certain-variables"><span class="header-section-number">9.2</span> Remove certain variables</a></li>
  <li><a href="#feature-engineer-date" id="toc-feature-engineer-date" class="nav-link" data-scroll-target="#feature-engineer-date"><span class="header-section-number">9.3</span> Feature engineer date</a></li>
  <li><a href="#create-dummy-variables" id="toc-create-dummy-variables" class="nav-link" data-scroll-target="#create-dummy-variables"><span class="header-section-number">9.4</span> Create dummy variables</a></li>
  <li><a href="#remove-zero-variance-variables" id="toc-remove-zero-variance-variables" class="nav-link" data-scroll-target="#remove-zero-variance-variables"><span class="header-section-number">9.5</span> Remove zero variance variables</a></li>
  <li><a href="#full-recipe" id="toc-full-recipe" class="nav-link" data-scroll-target="#full-recipe"><span class="header-section-number">9.6</span> Full recipe</a></li>
  </ul></li>
  <li><a href="#building-workflows" id="toc-building-workflows" class="nav-link" data-scroll-target="#building-workflows"><span class="header-section-number">10</span> Building workflows</a>
  <ul class="collapse">
  <li><a href="#define-model" id="toc-define-model" class="nav-link" data-scroll-target="#define-model"><span class="header-section-number">10.1</span> Define model</a></li>
  <li><a href="#define-workflow" id="toc-define-workflow" class="nav-link" data-scroll-target="#define-workflow"><span class="header-section-number">10.2</span> Define workflow</a></li>
  <li><a href="#fit-model-to-training-data" id="toc-fit-model-to-training-data" class="nav-link" data-scroll-target="#fit-model-to-training-data"><span class="header-section-number">10.3</span> Fit model to training data</a></li>
  <li><a href="#make-predictions-for-test-data" id="toc-make-predictions-for-test-data" class="nav-link" data-scroll-target="#make-predictions-for-test-data"><span class="header-section-number">10.4</span> Make predictions for test data</a></li>
  <li><a href="#evaluate-the-performance-2" id="toc-evaluate-the-performance-2" class="nav-link" data-scroll-target="#evaluate-the-performance-2"><span class="header-section-number">10.5</span> Evaluate the performance</a></li>
  <li><a href="#evaluate-the-performance-3" id="toc-evaluate-the-performance-3" class="nav-link" data-scroll-target="#evaluate-the-performance-3"><span class="header-section-number">10.6</span> Evaluate the performance</a></li>
  </ul></li>
  <li><a href="#from-probabilities-to-decisions" id="toc-from-probabilities-to-decisions" class="nav-link" data-scroll-target="#from-probabilities-to-decisions"><span class="header-section-number">11</span> From probabilities to decisions</a>
  <ul class="collapse">
  <li><a href="#cutoff-probability-0.5" id="toc-cutoff-probability-0.5" class="nav-link" data-scroll-target="#cutoff-probability-0.5"><span class="header-section-number">11.1</span> Cutoff probability: 0.5</a></li>
  <li><a href="#cutoff-probability-0.25" id="toc-cutoff-probability-0.25" class="nav-link" data-scroll-target="#cutoff-probability-0.25"><span class="header-section-number">11.2</span> Cutoff probability: 0.25</a></li>
  <li><a href="#cutoff-probability-0.75" id="toc-cutoff-probability-0.75" class="nav-link" data-scroll-target="#cutoff-probability-0.75"><span class="header-section-number">11.3</span> Cutoff probability: 0.75</a></li>
  <li><a href="#check-our-very-first-model" id="toc-check-our-very-first-model" class="nav-link" data-scroll-target="#check-our-very-first-model"><span class="header-section-number">11.4</span> Check our very first model</a></li>
  <li><a href="#evaluate-the-performance-4" id="toc-evaluate-the-performance-4" class="nav-link" data-scroll-target="#evaluate-the-performance-4"><span class="header-section-number">11.5</span> Evaluate the performance</a></li>
  <li><a href="#predict-penguins-sex" id="toc-predict-penguins-sex" class="nav-link" data-scroll-target="#predict-penguins-sex"><span class="header-section-number">11.6</span> Predict Penguins’ Sex</a></li>
  <li><a href="#penguins-evaluate-performance" id="toc-penguins-evaluate-performance" class="nav-link" data-scroll-target="#penguins-evaluate-performance"><span class="header-section-number">11.7</span> Penguins: Evaluate Performance</a></li>
  <li><a href="#penguins-cutoff-probability-0.5" id="toc-penguins-cutoff-probability-0.5" class="nav-link" data-scroll-target="#penguins-cutoff-probability-0.5"><span class="header-section-number">11.8</span> Penguins: Cutoff probability 0.5</a></li>
  <li><a href="#penguins-cutoff-probability-0.25" id="toc-penguins-cutoff-probability-0.25" class="nav-link" data-scroll-target="#penguins-cutoff-probability-0.25"><span class="header-section-number">11.9</span> Penguins: Cutoff probability 0.25</a></li>
  <li><a href="#penguins-cutoff-probability-0.75" id="toc-penguins-cutoff-probability-0.75" class="nav-link" data-scroll-target="#penguins-cutoff-probability-0.75"><span class="header-section-number">11.10</span> Penguins: Cutoff probability 0.75</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="W08.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">W#08: Predicting Categorical Variables, Logistic Regression, Classification Problems</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jan Lorenz </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="preliminaries" class="level2" data-number="0.1">
<h2 data-number="0.1" class="anchored" data-anchor-id="preliminaries"><span class="header-section-number">0.1</span> Preliminaries</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'palmerpenguins'

The following objects are masked from 'package:datasets':

    penguins, penguins_raw</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.3.0 ──
✔ broom        1.0.9     ✔ rsample      1.3.1
✔ dials        1.4.1     ✔ tune         1.3.0
✔ infer        1.0.9     ✔ workflows    1.3.0
✔ modeldata    1.5.1     ✔ workflowsets 1.1.1
✔ parsnip      1.3.2     ✔ yardstick    1.3.2
✔ recipes      1.3.1     
── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ scales::discard() masks purrr::discard()
✖ dplyr::filter()   masks stats::filter()
✖ recipes::fixed()  masks stringr::fixed()
✖ dplyr::lag()      masks stats::lag()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openintro)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: airports
Loading required package: cherryblossom
Loading required package: usdata

Attaching package: 'openintro'

The following object is masked from 'package:modeldata':

    ames</code></pre>
</div>
</div>
</section>
<section id="predicting-categorical-data" class="level1 page-columns page-full" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Predicting Categorical Data</h1>
<p>Large part of the content adapted from <a href="http://datasciencebox.org" class="uri">http://datasciencebox.org</a>.</p>
<section id="what-if-response-is-binary" class="level2 smaller" data-number="1.1">
<h2 class="smaller anchored" data-number="1.1" data-anchor-id="what-if-response-is-binary"><span class="header-section-number">1.1</span> What if response is binary?</h2>
<ul>
<li>Example: <strong>Spam filter</strong> for emails</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(email) <span class="co"># Part of the openintro data package </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3,921
Columns: 21
$ spam         &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ to_multiple  &lt;fct&gt; 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ from         &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ cc           &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 2, 1, 0, 2, 0, …
$ sent_email   &lt;fct&gt; 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, …
$ time         &lt;dttm&gt; 2012-01-01 07:16:41, 2012-01-01 08:03:59, 2012-01-01 17:…
$ image        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ attach       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ dollar       &lt;dbl&gt; 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 5, 0, 0, …
$ winner       &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no, n…
$ inherit      &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ viagra       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ password     &lt;dbl&gt; 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, …
$ num_char     &lt;dbl&gt; 11.370, 10.504, 7.773, 13.256, 1.231, 1.091, 4.837, 7.421…
$ line_breaks  &lt;int&gt; 202, 202, 192, 255, 29, 25, 193, 237, 69, 68, 25, 79, 191…
$ format       &lt;fct&gt; 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, …
$ re_subj      &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, …
$ exclaim_subj &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, …
$ urgent_subj  &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ exclaim_mess &lt;dbl&gt; 0, 1, 6, 48, 1, 1, 1, 18, 1, 0, 2, 1, 0, 10, 4, 10, 20, 0…
$ number       &lt;fct&gt; big, small, small, small, none, none, big, small, small, …</code></pre>
</div>
</div>
</section>
<section id="multinomial-response-variable" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="multinomial-response-variable"><span class="header-section-number">1.2</span> Multinomial response variable?</h2>
<ul>
<li>We will not cover other categorical variables than binary ones here.</li>
<li>However, many of the probabilistic concepts transfer.</li>
</ul>
</section>
<section id="variables" class="level2 smaller page-columns page-full" data-number="1.3">
<h2 class="smaller anchored" data-number="1.3" data-anchor-id="variables"><span class="header-section-number">1.3</span> Variables</h2>
<p><code>?email</code> shows all variable descriptions. For example:</p>
<ul>
<li><code>spam</code> Indicator for whether the email was spam.</li>
<li><code>from</code> Whether the message was listed as from anyone (this is usually set by default for regular outgoing email).</li>
<li><code>cc</code> Number of people cc’ed.</li>
<li><code>time</code> Time at which email was sent.</li>
<li><code>attach</code> The number of attached files.</li>
<li><code>dollar</code> The number of times a dollar sign or the word “dollar” appeared in the email.</li>
<li><code>num_char</code> The number of characters in the email, in thousands.</li>
<li><code>re_subj</code> Whether the subject started with “Re:”, “RE:”, “re:”, or “rE:”</li>
</ul>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>The development, extraction, or discovery of such variables is called <strong>feature engineering</strong>, <strong>feature extraction</strong> or <strong>feature discovery</strong>. Usually, a combination of <em>domain knowledge</em> and <em>data science</em> skill is needed to do this.</p>
</div></div></section>
<section id="data-exploration" class="level2 smaller" data-number="1.4">
<h2 class="smaller anchored" data-number="1.4" data-anchor-id="data-exploration"><span class="header-section-number">1.4</span> Data exploration</h2>
<p>Would you expect spam to be longer or shorter?</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>email <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> num_char, <span class="at">y =</span> spam)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W08_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>. . .</p>
<p>Would you expect spam subject to start with “Re:” or the like?</p>
<p>. . .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>email <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> re_subj, <span class="at">fill =</span> spam)) <span class="sc">+</span> <span class="fu">geom_bar</span>()  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W08_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="linear-models" class="level2 smaller page-columns page-full" data-number="1.5">
<h2 class="smaller anchored" data-number="1.5" data-anchor-id="linear-models"><span class="header-section-number">1.5</span> Linear models?</h2>
<p>Both seem to give some signal. <strong>How can we model the relationship?</strong></p>
<p>We focus first on just <code>num_char</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>email <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> num_char, <span class="at">y =</span> <span class="fu">as.numeric</span>(spam)<span class="sc">-</span><span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W08_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We would like to have a better concept!</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>Why do we need <code>y = as.numeric(spam)-1</code> instead of just <code>y = spam</code>?? Answer: <code>spam</code> is a factor although it looks like a numeric variable. The underlying integers for the two categories <code>"0"</code> and <code>"1"</code> are <code>1</code> and <code>2</code>. The strange form transforms the factor into a numerical variables with the values <code>0</code> and <code>1</code> as we need it for a target variable in a linear model.</p>
</div></div></section>
<section id="a-penguins-example---predict-sex" class="level2 smaller" data-number="1.6">
<h2 class="smaller anchored" data-number="1.6" data-anchor-id="a-penguins-example---predict-sex"><span class="header-section-number">1.6</span> A penguins example - predict sex</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>penguins <span class="sc">|&gt;</span> <span class="fu">na.omit</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> <span class="fu">as.numeric</span>(sex)<span class="sc">-</span><span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W08_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span style="color:red;">It does not make much sense to predict 0-1-values with a linear model.</span></p>
</section>
<section id="a-probabilistic-concept" class="level2 smaller" data-background-color="aquamarine" data-number="1.7">
<h2 class="smaller anchored" data-background-color="aquamarine" data-number="1.7" data-anchor-id="a-probabilistic-concept"><span class="header-section-number">1.7</span> A probabilistic concept</h2>
<ul>
<li>We treat each outcome (spam and not) as successes and failures arising from separate Bernoulli trials
<ul>
<li><strong>Bernoulli trial:</strong> a random experiment with exactly two possible outcomes, <em>success</em> and <em>failure</em>, in which the <em>probability of success</em> is the same every time the experiment is conducted</li>
</ul></li>
</ul>
<p>. . .</p>
<ul>
<li>Each email is treated as Bernoulli trial with separate probability of success</li>
</ul>
<p><span class="math display">\[ y_i ∼ \text{Bernoulli}(p_i) \]</span></p>
<p>. . .</p>
<ul>
<li>We use the predictor variables to model the Bernoulli parameter <span class="math inline">\(p_i\)</span></li>
</ul>
<p>. . .</p>
<ul>
<li>Now we conceptualized a continuous response, but still a linear model does not fit perfectly for <span class="math inline">\(p_i\)</span> (since a probability is between 0 and 1).</li>
<li>However, we can transform the linear model to have the appropriate range.</li>
</ul>
</section>
</section>
<section id="generalized-linear-models" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Generalized linear models</h1>
<section id="characterising-glms" class="level2 smaller" data-background-color="aquamarine" data-number="2.1">
<h2 class="smaller anchored" data-background-color="aquamarine" data-number="2.1" data-anchor-id="characterising-glms"><span class="header-section-number">2.1</span> Characterising GLMs</h2>
<ul>
<li><strong>Generalized linear models (GLMs)</strong> are a way of addressing many problems in regression</li>
<li>Logistic regression is one example</li>
</ul>
<p>All GLMs have the following three characteristics:</p>
<ol type="1">
<li>A <strong>probability distribution</strong> as a generative model for the outcome variable <span class="math inline">\(y_i \sim \text{Distribution}(\text{parameter})\)</span></li>
</ol>
<p>. . .</p>
<ol start="2" type="1">
<li>A <strong>linear model</strong> <span class="math inline">\(\eta = \beta_0 + \beta_1 X_1 + \cdots + \beta_k X_k\)</span><br>
where <span class="math inline">\(\eta\)</span> is related to a mean parameter of the distribution by the …</li>
</ol>
<p>. . .</p>
<ol start="3" type="1">
<li><strong>Link function</strong> that relates the linear model to the parameter of the outcome distribution.</li>
</ol>
</section>
</section>
<section id="logistic-regression" class="level1 page-columns page-full" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Logistic regression</h1>
<section id="logistic-regression-1" class="level2 smaller" data-background-color="aquamarine" data-number="3.1">
<h2 class="smaller anchored" data-background-color="aquamarine" data-number="3.1" data-anchor-id="logistic-regression-1"><span class="header-section-number">3.1</span> Logistic regression</h2>
<ul>
<li><strong>Logistic regression</strong> is a GLM used to model a binary categorical outcome using numerical and categorical predictors.</li>
<li>The <em>distribution</em> is the Bernoulli distribution with parameter <span class="math inline">\(p\)</span> (success probability).</li>
<li>As <em>link function</em> connecting <span class="math inline">\(\eta_i\)</span> to <span class="math inline">\(p_i\)</span> we use the <strong>logit function</strong>.</li>
</ul>
<p>. . .</p>
<ul>
<li><strong>Logit function:</strong> <span class="math inline">\(\text{logit}: [0,1] \to \mathbb{R}\)</span></li>
</ul>
<p><span class="math display">\[\text{logit}(p) = \log\left(\frac{p}{1-p}\right)\]</span></p>
<ul>
<li><span class="math inline">\(\frac{p}{1-p}\)</span> is called the <strong>odds</strong> of a success which happens with probability <span class="math inline">\(p\)</span>.<br>
Example: Roll a six with a die has <span class="math inline">\(p=1/6\)</span>. Thus, the odds are <span class="math inline">\(\frac{1/6}{5/6} = 1/5\)</span>. Sometimes written as 1:5. <em>“The odds of success are one to five.”</em></li>
</ul>
</section>
<section id="properties-of-the-logit" class="level2 smaller page-columns page-full" data-background-color="aquamarine" data-number="3.2">
<h2 class="smaller anchored" data-background-color="aquamarine" data-number="3.2" data-anchor-id="properties-of-the-logit"><span class="header-section-number">3.2</span> Properties of the logit</h2>
<ul>
<li>Logit takes values between 0 and 1 and returns values between <span class="math inline">\(-\infty\)</span> and <span class="math inline">\(\infty\)</span></li>
<li>The inverse of the logit function if the <strong>logistic function</strong> (mapping values from <span class="math inline">\(-\infty\)</span> and <span class="math inline">\(\infty\)</span> to values between 0 and 1): <span class="math display">\[\text{logit}^{-1}(x) = \text{logistic}(x) = \frac{e^x}{1+e^x} = \frac{1}{1+e^{-x}}\]</span></li>
<li>Logit can be interpreted as the log odds of a success – more on this later.</li>
</ul>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<ul>
<li>The logistic function is the solution of the differential equation <span class="math inline">\(\frac{d}{dx}f(x) = f(x)(1-f(x))\)</span> which also appears in the SI-model of epidemics (and other models of exponential growth with saturation).</li>
<li>Good exercises to check your math skills:
<ol type="1">
<li>Show that <span class="math inline">\(\text{logit}^{-1}(x) = \text{logistic}(x)\)</span> or the other way round.</li>
<li>Transform <span class="math inline">\(\frac{e^x}{1+e^x}\)</span> into <span class="math inline">\(\frac{1}{1+e^{-x}}\)</span>.</li>
<li>Check that <span class="math inline">\(\text{logistic}(x)\)</span> is a solution to <span class="math inline">\(\frac{d}{dx}f(x) = f(x)(1-f(x))\)</span>.</li>
</ol></li>
<li>You can request hints from me when you get stuck.</li>
</ul>
</div></div></section>
<section id="logit-and-logistic-function" class="level2 smaller" data-background-color="aquamarine" data-number="3.3">
<h2 class="smaller anchored" data-background-color="aquamarine" data-number="3.3" data-anchor-id="logit-and-logistic-function"><span class="header-section-number">3.3</span> Logit and <span style="color:red;">logistic</span> function</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x) <span class="fu">log</span>(x<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>x)), <span class="at">xlim=</span><span class="fu">c</span>(<span class="fl">0.001</span>,<span class="fl">0.999</span>), <span class="at">n =</span> <span class="dv">500</span>) <span class="sc">+</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>x)), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">coord_fixed</span>() <span class="sc">+</span> <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">24</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 6 rows containing missing values or values outside the scale range
(`geom_function()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W08_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-logistic-regression-model" class="level2" data-background-color="aquamarine" data-number="3.4">
<h2 data-background-color="aquamarine" data-number="3.4" class="anchored" data-anchor-id="the-logistic-regression-model"><span class="header-section-number">3.4</span> The logistic regression model</h2>
<ul>
<li>Based on the three GLM criteria we have
<ul>
<li><span class="math inline">\(y_i \sim \text{Bernoulli}(p_i)\)</span></li>
<li><span class="math inline">\(\eta_i = \beta_0+\beta_1 x_{1,i} + \cdots + \beta_n x_{n,i}\)</span></li>
<li><span class="math inline">\(\text{logit}(p_i) = \eta_i\)</span></li>
</ul></li>
</ul>
<p>. . .</p>
<ul>
<li>From which we get</li>
</ul>
<p><span class="math display">\[p_i = \frac{e^{\beta_0+\beta_1 x_{1,i} + \cdots + \beta_k x_{k,i}}}{1 + e^{\beta_0+\beta_1 x_{1,i} + \cdots + \beta_k x_{k,i}}}\]</span></p>
</section>
<section id="modeling-spam" class="level2 smaller page-columns page-full" data-number="3.5">
<h2 class="smaller anchored" data-number="3.5" data-anchor-id="modeling-spam"><span class="header-section-number">3.5</span> Modeling spam</h2>
<p>With <code>tidymodels</code> we fit a GLM in the same way as a linear model except we</p>
<ul>
<li>specify the model with <code>logistic_reg()</code></li>
<li>use <code>"glm"</code> instead of <code>"lm"</code> as the engine</li>
<li>define <code>family = "binomial"</code> for the link function to be used in the model</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>spam_fit <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(spam <span class="sc">~</span> num_char, <span class="at">data =</span> email, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(spam_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)  -1.80     0.0716     -25.1  2.04e-139
2 num_char     -0.0621   0.00801     -7.75 9.50e- 15</code></pre>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<ul>
<li>The family is <em>binomial</em> because the Bernoulli distribution is a special case of the binomial distribution <span class="math inline">\(\text{Binomial}(n,p)\)</span> with <span class="math inline">\(n=1\)</span>.</li>
<li>The binomial distribution specifies the probability to have <span class="math inline">\(k\)</span> successes in <span class="math inline">\(n\)</span> Bernoulli trials with the same success probability <span class="math inline">\(p\)</span>.</li>
</ul>
</div></div></section>
<section id="spam-model" class="level2 smaller" data-number="3.6">
<h2 class="smaller anchored" data-number="3.6" data-anchor-id="spam-model"><span class="header-section-number">3.6</span> Spam model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(spam_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)  -1.80     0.0716     -25.1  2.04e-139
2 num_char     -0.0621   0.00801     -7.75 9.50e- 15</code></pre>
</div>
</div>
<p>Model: <span class="math display">\[\log\left(\frac{p}{1-p}\right) = -1.80-0.0621\cdot \text{num_char}\]</span></p>
</section>
<section id="predicted-probability-examples" class="level2 smaller" data-number="3.7">
<h2 class="smaller anchored" data-number="3.7" data-anchor-id="predicted-probability-examples"><span class="header-section-number">3.7</span> Predicted probability: Examples</h2>
<p>We can compute the <strong>predicted probability</strong> that an email with 2000 character is spam as follows:</p>
<p><span class="math display">\[\log\left(\frac{p}{1-p}\right) = -1.80-0.0621\cdot 2 = -1.9242\]</span></p>
<p>(Note: <code>num_char</code> is in thousands.)</p>
<p><span class="math display">\[\frac{p}{1-p} = e^{-1.9242} = 0.15 \Rightarrow p = 0.15 \cdot (1 - p)\]</span></p>
<p><span class="math display">\[p = 0.15 - 0.15\cdot p \Rightarrow 1.15\cdot p = 0.15\]</span></p>
<p><span class="math display">\[p = 0.15 / 1.15 = 0.13\]</span></p>
</section>
<section id="predicted-probability" class="level2 smaller" data-number="3.8">
<h2 class="smaller anchored" data-number="3.8" data-anchor-id="predicted-probability"><span class="header-section-number">3.8</span> Predicted probability</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>logistic <span class="ot">&lt;-</span> <span class="cf">function</span>(t) <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>t))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">15</span>,<span class="dv">40</span>), <span class="at">y =</span> <span class="fu">logistic</span>(<span class="sc">-</span><span class="fl">1.80-0.0621</span><span class="sc">*</span>x))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>email <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> num_char, <span class="at">y =</span> <span class="fu">as.numeric</span>(spam)<span class="sc">-</span><span class="dv">1</span>)) <span class="sc">+</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x) <span class="fu">logistic</span>(<span class="sc">-</span><span class="fl">1.80-0.0621</span><span class="sc">*</span>x),<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="at">data =</span> preds, <span class="at">mapping =</span> <span class="fu">aes</span>(x,y), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W08_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Spam probability 2,000 characters: 0.1273939<br>
Spam probability 15,000 characters: 0.06114<br>
Spam probability 40,000 characters: 0.0135999</p>
</section>
<section id="interpretation-of-coefficients" class="level2 smaller" data-number="3.9">
<h2 class="smaller anchored" data-number="3.9" data-anchor-id="interpretation-of-coefficients"><span class="header-section-number">3.9</span> Interpretation of coefficients</h2>
<p><span class="math display">\[\log\left(\frac{p}{1-p}\right) = -1.80-0.0621\cdot \text{num_char}\]</span></p>
<p>What does an increase by thousand characters (<code>num_char + 1</code>) imply?</p>
<p>. . .</p>
<p>Let us assume the predicted probability of an email is <span class="math inline">\(p_0\)</span>. Then an increase of <code>num_char</code> by one implied that the log-odds become</p>
<p><span class="math display">\[\log\left(\frac{p_0}{1-p_0}\right) - 0.0621 = \log\left(\frac{p_0}{1-p_0}\right) - \log(e^{0.0621})\]</span></p>
<p><span class="math display">\[ = \log\left(\frac{p_0}{1-p_0}\right) + \log(\frac{1}{e^{0.0621}}) = \log\left(\frac{p_0}{1-p_0} \frac{1}{e^{0.0621}}\right) = \log\left(\frac{p_0}{1-p_0} 0.94\right)\]</span></p>
<p>That means the odds of being spam decrease by 6%.</p>
</section>
<section id="penguins-example" class="level2 smaller" data-number="3.10">
<h2 class="smaller anchored" data-number="3.10" data-anchor-id="penguins-example"><span class="header-section-number">3.10</span> Penguins example</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>sex_fit <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(sex <span class="sc">~</span> body_mass_g, <span class="at">data =</span> <span class="fu">na.omit</span>(penguins), <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(sex_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept) -5.16     0.724        -7.13 1.03e-12
2 body_mass_g  0.00124  0.000173      7.18 7.10e-13</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">na.omit</span>(penguins) <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> sex)) <span class="sc">+</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x) <span class="fu">logistic</span>(<span class="sc">-</span><span class="fl">5.16+0.00124</span><span class="sc">*</span>x) <span class="sc">+</span> <span class="dv">1</span>,<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">7000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Multiple drawing groups in `geom_function()`
ℹ Did you use the correct group, colour, or fill aesthetics?</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W08_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="summarizing-the-idea-of-logistic-regression" class="level2 smaller" data-number="3.11">
<h2 class="smaller anchored" data-number="3.11" data-anchor-id="summarizing-the-idea-of-logistic-regression"><span class="header-section-number">3.11</span> Summarizing the Idea of Logistic Regression</h2>
<ul>
<li>We want to explain/predict a binary response variable.</li>
<li>We want to use the concept of linear models.</li>
<li>To that end we first interprete each outcome as the outcome of a probabilisitic event happening with probability <span class="math inline">\(p_i\)</span>. That way we transform the problem from modeling a binary outcome to a numerical outcome.</li>
<li>However, probabilities are bounded between 0 and 1.</li>
<li>We use the logit function to map probabilities to the real line. That means we predict the log-odds of the probability.</li>
<li>We model the log-odds with a linear model.</li>
</ul>
</section>
</section>
<section id="sensitivity-and-specificity" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Sensitivity and specificity</h1>
<section id="false-positive-and-negative" class="level2 smaller" data-number="4.1">
<h2 class="smaller anchored" data-number="4.1" data-anchor-id="false-positive-and-negative"><span class="header-section-number">4.1</span> False positive and negative</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 28%">
<col style="width: 35%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Email labelled spam</th>
<th>Email labelled not spam</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Email is spam</strong></td>
<td>True positive</td>
<td>False negative (Type 2 error)</td>
</tr>
<tr class="even">
<td><strong>Email is not spam</strong></td>
<td>False positive (Type 1 error)</td>
<td>True negative</td>
</tr>
</tbody>
</table>
</section>
<section id="confusion-matrix" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="confusion-matrix"><span class="header-section-number">4.2</span> Confusion matrix</h2>
<p>More general: <a href="https://en.wikipedia.org/wiki/Confusion_matrix"><strong>Confusion matrix</strong></a> of statistical classification:</p>
<p><img src="img/confusion_small.png" class="img-fluid"></p>
</section>
<section id="sensitivity-and-specificity-1" class="level2 smaller" data-number="4.3">
<h2 class="smaller anchored" data-number="4.3" data-anchor-id="sensitivity-and-specificity-1"><span class="header-section-number">4.3</span> Sensitivity and specificity</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p><img src="img/confusion_small.png" class="img-fluid"></p>
</div><div class="column" style="width:60%;">
<p><strong>Sensitivity</strong> is the <em>true positive rate</em>: TP / (TP + FN)<br>
<strong>Specificity</strong> is the <em>true negative rate</em>: TN / (TN + FP)</p>
</div>
</div>
<p>For spam a <em>positive</em> case is an email labelled as <em>spam</em>:</p>
<p><strong>Sensitivity:</strong> Fraction of emails <em>labelled as</em> spam among all emails which <em>are</em> spam.<br>
Low sensitivity <span class="math inline">\(\to\)</span> More false negatives <span class="math inline">\(\to\)</span> More spam in you inbox!</p>
<p><strong>Specificity:</strong> Fraction of emails <em>labelled as not</em> spam among all emails which <em>are not</em> spam.<br>
Low specificity <span class="math inline">\(\to\)</span> More false positives <span class="math inline">\(\to\)</span> More relevant emails in spam folder!</p>
<p>. . .</p>
<p>If you were designing a spam filter, would you want sensitivity and specificity to be high or low? What are the trade-offs associated with each decision?</p>
</section>
<section id="covid-19-tests" class="level2 smaller" data-number="4.4">
<h2 class="smaller anchored" data-number="4.4" data-anchor-id="covid-19-tests"><span class="header-section-number">4.4</span> COVID-19 tests</h2>
<p>A COVID-19 test is called <em>positive</em> when it indicates the presence of the virus.</p>
<p><em>What is the sensitivity of a test?</em></p>
<p>. . .</p>
<p>Probability the test is positive when the tested person has COVID-19. (The true positive rate.)</p>
<p>. . .</p>
<p><em>What is the specificity of a test?</em></p>
<p>. . .</p>
<p>Probability the test is negative when the tested person does not have COVID-19. (The true negative rate.)</p>
<p>Often the sensitivity is around 90% and the specificity is around 99%. What does that mean?</p>
<p>. . .</p>
<ul>
<li>When you do not have COVID the test is more likely to be correct, than when you do have COVID. However, specificity and sensitivity do not tell something about the probability to have COVID when the test is positive, or to not have COVID when the test is negative.</li>
</ul>
</section>
<section id="another-view" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="another-view"><span class="header-section-number">4.5</span> Another view</h2>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/5/5a/Sensitivity_and_specificity_1.01.svg" class="img-fluid"></p>
</section>
</section>
<section id="prediction" class="level1 page-columns page-full" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Prediction</h1>
<section id="prediction-vs.-explanation" class="level2 smaller" data-number="5.1">
<h2 class="smaller anchored" data-number="5.1" data-anchor-id="prediction-vs.-explanation"><span class="header-section-number">5.1</span> Prediction vs.&nbsp;Explanation</h2>
<p><strong>Explanation</strong> and <strong>Prediction</strong> are different <strong>Modelling Mindsets</strong><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<ul>
<li>With an <em>Explanatory Mindset</em> we want to understand the relationship between the predictors and the outcome.
<ul>
<li>We interpret coefficients</li>
<li>We ask what variance can be explained by a linear model or a PCA</li>
</ul></li>
<li>With a <em>Predictive Mindset</em> we want to predict the outcome for new observations.
<ul>
<li>We use the model to predict the outcome for new observations</li>
<li>We ask how well we can predict the outcome for new observations</li>
<li>We may ignore why the model works</li>
</ul></li>
</ul>
<p>Important: The mindsets are very different but they may use the same models!</p>
</section>
<section id="prediction-example-building-a-spam-filter" class="level2 smaller" data-number="5.2">
<h2 class="smaller anchored" data-number="5.2" data-anchor-id="prediction-example-building-a-spam-filter"><span class="header-section-number">5.2</span> Prediction Example: Building a spam filter</h2>
<ul>
<li>Data: Set of emails and we know
<ul>
<li>if each email is spam or not</li>
<li>several other features</li>
</ul></li>
<li>Use logistic regression to predict the probability that an incoming email is spam</li>
<li>Use model selection to pick the model with the best predictive performance</li>
</ul>
<p>. . .</p>
<ul>
<li>Building a model to predict the probability that an email is spam is only half of the battle! We also need a decision rule about which emails get flagged as spam (e.g.&nbsp;what probability should we use as out cutoff?)</li>
</ul>
<p>. . .</p>
<ul>
<li>A simple approach: choose a single threshold probability and any email that exceeds that probability is flagged as spam</li>
</ul>
</section>
<section id="emails-use-all-predictors" class="level2 smaller page-columns page-full" data-number="5.3">
<h2 class="smaller anchored" data-number="5.3" data-anchor-id="emails-use-all-predictors"><span class="header-section-number">5.3</span> Emails: Use all predictors</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(spam <span class="sc">~</span> ., <span class="at">data =</span> email, <span class="at">family =</span> <span class="st">"binomial"</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">22</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 22 × 5
   term         estimate std.error statistic  p.value
   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercept)  -9.09e+1   9.80e+3  -0.00928 9.93e- 1
 2 to_multiple1 -2.68e+0   3.27e-1  -8.21    2.25e-16
 3 from1        -2.19e+1   9.80e+3  -0.00224 9.98e- 1
 4 cc            1.88e-2   2.20e-2   0.855   3.93e- 1
 5 sent_email1  -2.07e+1   3.87e+2  -0.0536  9.57e- 1
 6 time          8.48e-8   2.85e-8   2.98    2.92e- 3
 7 image        -1.78e+0   5.95e-1  -3.00    2.73e- 3
 8 attach        7.35e-1   1.44e-1   5.09    3.61e- 7
 9 dollar       -6.85e-2   2.64e-2  -2.59    9.64e- 3
10 winneryes     2.07e+0   3.65e-1   5.67    1.41e- 8
11 inherit       3.15e-1   1.56e-1   2.02    4.32e- 2
12 viagra        2.84e+0   2.22e+3   0.00128 9.99e- 1
13 password     -8.54e-1   2.97e-1  -2.88    4.03e- 3
14 num_char      5.06e-2   2.38e-2   2.13    3.35e- 2
15 line_breaks  -5.49e-3   1.35e-3  -4.06    4.91e- 5
16 format1      -6.14e-1   1.49e-1  -4.14    3.53e- 5
17 re_subj1     -1.64e+0   3.86e-1  -4.25    2.16e- 5
18 exclaim_subj  1.42e-1   2.43e-1   0.585   5.58e- 1
19 urgent_subj1  3.88e+0   1.32e+0   2.95    3.18e- 3
20 exclaim_mess  1.08e-2   1.81e-3   5.98    2.23e- 9
21 numbersmall  -1.19e+0   1.54e-1  -7.74    9.62e-15
22 numberbig    -2.95e-1   2.20e-1  -1.34    1.79e- 1</code></pre>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>We treat the warning later.</p>
</div></div></section>
<section id="the-prediction-task" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="the-prediction-task"><span class="header-section-number">5.4</span> The prediction task</h2>
<ul>
<li>The mechanics of prediction is <strong>easy</strong>:
<ul>
<li>Plug in values of predictors to the model equation</li>
<li>Calculate the predicted value of the response variable, <span class="math inline">\(\hat{y}\)</span></li>
</ul></li>
</ul>
<p>. . .</p>
<ul>
<li>Getting it right is <strong>harder</strong>
<ul>
<li>There is no guarantee the model estimates you have are correct</li>
<li>Or that your model will perform as well with <strong>new data</strong> as it did with your sample data</li>
</ul></li>
</ul>
</section>
<section id="balance-over--and-underfitting" class="level2 page-columns page-full" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="balance-over--and-underfitting"><span class="header-section-number">5.5</span> Balance Over- and Underfitting</h2>
<p>In a one predictor model we can show both visually:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>lm_fit <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y4 <span class="sc">~</span> x2, <span class="at">data =</span> association)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>loess_fit <span class="ot">&lt;-</span> <span class="fu">loess</span>(y4 <span class="sc">~</span> x2, <span class="at">data =</span> association)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>loess_overfit <span class="ot">&lt;-</span> <span class="fu">loess</span>(y4 <span class="sc">~</span> x2, <span class="at">span =</span> <span class="fl">0.05</span>, <span class="at">data =</span> association)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric,
: k-d tree limited by memory. ncmax= 200</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>association <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x2, y4) <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Underfit =</span> <span class="fu">augment</span>(lm_fit<span class="sc">$</span>fit) <span class="sc">|&gt;</span> <span class="fu">select</span>(.fitted) <span class="sc">|&gt;</span> <span class="fu">pull</span>(),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">OK       =</span> <span class="fu">augment</span>(loess_fit) <span class="sc">|&gt;</span> <span class="fu">select</span>(.fitted) <span class="sc">|&gt;</span> <span class="fu">pull</span>(),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Overfit  =</span> <span class="fu">augment</span>(loess_overfit) <span class="sc">|&gt;</span> <span class="fu">select</span>(.fitted) <span class="sc">|&gt;</span> <span class="fu">pull</span>(),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols      =</span> Underfit<span class="sc">:</span>Overfit,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to  =</span> <span class="st">"fit"</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"y_hat"</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">fct_relevel</span>(fit, <span class="st">"Underfit"</span>, <span class="st">"OK"</span>, <span class="st">"Overfit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x2)) <span class="sc">+</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y4), <span class="at">color =</span> <span class="st">"darkgray"</span>) <span class="sc">+</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_hat, <span class="at">group =</span> fit, <span class="at">color =</span> fit), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">end =</span> <span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W08_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>This is simulated data.</p>
</div></div></section>
<section id="spending-our-data" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="spending-our-data"><span class="header-section-number">5.6</span> Spending our data</h2>
<p><strong>Problem:</strong></p>
<ul>
<li>There are several steps to create a useful prediction model: parameter estimation, model selection, performance assessment, etc.</li>
<li>Doing all of this on the entire data we have available can lead to <strong>overfitting</strong>.</li>
</ul>
<p><strong>Solution:</strong> We subsets our data for different tasks, as opposed to allocating all data to parameter estimation (as we have done so far).</p>
</section>
</section>
<section id="splitting-data" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Splitting Data</h1>
<section id="splitting-data-1" class="level2 smaller" data-number="6.1">
<h2 class="smaller anchored" data-number="6.1" data-anchor-id="splitting-data-1"><span class="header-section-number">6.1</span> Splitting data</h2>
<ul>
<li><strong>Training set:</strong>
<ul>
<li>Sandbox for model building</li>
<li>Spend most of your time using the training set to develop the model</li>
<li>Majority of the data (usually 80%)</li>
</ul></li>
<li><strong>Testing set:</strong>
<ul>
<li>Held in reserve to determine efficacy of one or two chosen models</li>
<li>Critical to look at it once, otherwise it becomes part of the modeling process</li>
<li>Remainder of the data (usually 20%)</li>
</ul></li>
</ul>
<p><span style="color:blue;">Sidenote:</span> Splitting data is very important for the predictive questions, because we want to know how well our model performs on new data. It is not relevant for explanatory questions where we want to interpret coefficients and infer about the underlying population.</p>
</section>
<section id="performing-the-split" class="level2 smaller" data-number="6.2">
<h2 class="smaller anchored" data-number="6.2" data-anchor-id="performing-the-split"><span class="header-section-number">6.2</span> Performing the split</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix random numbers by setting the seed </span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Enables analysis to be reproducible when random numbers are used </span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1116</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Put 80% of the data into the training set </span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>email_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(email, <span class="at">prop =</span> <span class="fl">0.80</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frames for the two sets:</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">training</span>(email_split)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>test_data  <span class="ot">&lt;-</span> <span class="fu">testing</span>(email_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>A note on the seed:</strong> The seed is an arbitrary number that is used to initialize a pseudorandom number generator. The same seed will always result in the same sequence of pseudorandom numbers. This is useful for reproducibility.</p>
</section>
<section id="peek-at-the-split" class="level2 smaller" data-number="6.3">
<h2 class="smaller anchored" data-number="6.3" data-anchor-id="peek-at-the-split"><span class="header-section-number">6.3</span> Peek at the split</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(train_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3,136
Columns: 21
$ spam         &lt;fct&gt; 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, …
$ to_multiple  &lt;fct&gt; 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, …
$ from         &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ cc           &lt;int&gt; 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 35, 0, 0, 0, 0, 0,…
$ sent_email   &lt;fct&gt; 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, …
$ time         &lt;dttm&gt; 2012-01-25 23:46:55, 2012-01-03 06:28:28, 2012-02-04 17:…
$ image        &lt;dbl&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ attach       &lt;dbl&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ dollar       &lt;dbl&gt; 10, 0, 0, 0, 0, 0, 13, 0, 0, 0, 2, 0, 0, 0, 14, 0, 0, 0, …
$ winner       &lt;fct&gt; no, no, no, no, no, no, no, yes, no, no, no, no, no, no, …
$ inherit      &lt;dbl&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ viagra       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ password     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, …
$ num_char     &lt;dbl&gt; 23.308, 1.162, 4.732, 42.238, 1.228, 25.599, 16.764, 10.7…
$ line_breaks  &lt;int&gt; 477, 2, 127, 712, 30, 674, 367, 226, 98, 671, 46, 192, 67…
$ format       &lt;fct&gt; 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, …
$ re_subj      &lt;fct&gt; 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, …
$ exclaim_subj &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, …
$ urgent_subj  &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ exclaim_mess &lt;dbl&gt; 12, 0, 2, 2, 2, 31, 2, 0, 0, 1, 0, 1, 2, 0, 2, 0, 11, 1, …
$ number       &lt;fct&gt; small, none, big, big, small, small, small, small, small,…</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(test_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 785
Columns: 21
$ spam         &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ to_multiple  &lt;fct&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, …
$ from         &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ cc           &lt;int&gt; 0, 1, 0, 1, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0, …
$ sent_email   &lt;fct&gt; 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, …
$ time         &lt;dttm&gt; 2012-01-01 18:55:06, 2012-01-01 20:38:32, 2012-01-02 06:…
$ image        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, …
$ attach       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, …
$ dollar       &lt;dbl&gt; 0, 0, 5, 0, 0, 0, 0, 5, 4, 0, 0, 0, 21, 0, 0, 2, 9, 0, 0,…
$ winner       &lt;fct&gt; no, no, no, no, no, no, no, no, no, no, no, no, no, no, n…
$ inherit      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ viagra       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ password     &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 2, …
$ num_char     &lt;dbl&gt; 4.837, 15.075, 18.037, 45.842, 11.438, 1.482, 14.431, 0.9…
$ line_breaks  &lt;int&gt; 193, 354, 345, 881, 125, 24, 296, 13, 192, 14, 32, 30, 55…
$ format       &lt;fct&gt; 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, …
$ re_subj      &lt;fct&gt; 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, …
$ exclaim_subj &lt;dbl&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ urgent_subj  &lt;fct&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ exclaim_mess &lt;dbl&gt; 1, 10, 20, 5, 2, 0, 0, 0, 6, 0, 0, 1, 3, 0, 4, 0, 1, 0, 1…
$ number       &lt;fct&gt; big, small, small, big, small, none, small, small, small,…</code></pre>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="workflow-of-predictive-modeling" class="level1 page-columns page-full" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Workflow of Predictive Modeling</h1>
<section id="fit-a-model-to-the-training-dataset" class="level2 page-columns page-full" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="fit-a-model-to-the-training-dataset"><span class="header-section-number">7.1</span> Fit a model to the training dataset</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>email_fit <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(spam <span class="sc">~</span> ., <span class="at">data =</span> train_data, <span class="at">family =</span> <span class="st">"binomial"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
</div>
<p>We get a warning and should explore the reasons for 0 or 1 probability.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<ul>
<li>A deeper looking into the predicted probabilities (not shown here) shows that 4 cases are predicted to be spam with 100% probability, as well as 864 cases are predicted to be not spam with 100% probability.</li>
<li>Note: The <code>dplyr</code> function <code>near</code> was used to assess if predicted probabilities were one.</li>
<li>This is usually undesirable. Hence the warning.</li>
</ul>
</div></div></section>
<section id="look-at-categorical-predictors" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="look-at-categorical-predictors"><span class="header-section-number">7.2</span> Look at categorical predictors</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>factor_predictors <span class="ot">&lt;-</span> train_data <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.factor), <span class="sc">-</span>spam) <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>p_to_multiple <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train_data, <span class="fu">aes</span>(<span class="at">x =</span> to_multiple, <span class="at">fill =</span> spam)) <span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E48957"</span>, <span class="st">"#CA235F"</span>))</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>p_from <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train_data, <span class="fu">aes</span>(<span class="at">x =</span> from, <span class="at">fill =</span> spam)) <span class="sc">+</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E48957"</span>, <span class="st">"#CA235F"</span>))</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>p_sent_email <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train_data, <span class="fu">aes</span>(<span class="at">x =</span> sent_email, <span class="at">fill =</span> spam)) <span class="sc">+</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E48957"</span>, <span class="st">"#CA235F"</span>))</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>p_winner <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train_data, <span class="fu">aes</span>(<span class="at">x =</span> winner, <span class="at">fill =</span> spam)) <span class="sc">+</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E48957"</span>, <span class="st">"#CA235F"</span>))</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>p_format <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train_data, <span class="fu">aes</span>(<span class="at">x =</span> format, <span class="at">fill =</span> spam)) <span class="sc">+</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E48957"</span>, <span class="st">"#CA235F"</span>))</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>p_re_subj <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train_data, <span class="fu">aes</span>(<span class="at">x =</span> re_subj, <span class="at">fill =</span> spam)) <span class="sc">+</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E48957"</span>, <span class="st">"#CA235F"</span>))</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>p_urgent_subj <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train_data, <span class="fu">aes</span>(<span class="at">x =</span> urgent_subj, <span class="at">fill =</span> spam)) <span class="sc">+</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E48957"</span>, <span class="st">"#CA235F"</span>))</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>p_number <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(train_data, <span class="fu">aes</span>(<span class="at">x =</span> number, <span class="at">fill =</span> spam)) <span class="sc">+</span></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E48957"</span>, <span class="st">"#CA235F"</span>))</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>p_to_multiple <span class="sc">+</span> p_from <span class="sc">+</span> p_sent_email <span class="sc">+</span> p_winner <span class="sc">+</span> p_format <span class="sc">+</span> p_re_subj <span class="sc">+</span> p_urgent_subj <span class="sc">+</span> p_number <span class="sc">+</span></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">guides =</span> <span class="st">"collect"</span>) <span class="sc">&amp;</span> </span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W08_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Closer look at <code>from</code> and <code>sent_email</code>.</p>
</section>
<section id="counting-cases" class="level2 smaller" data-number="7.3">
<h2 class="smaller anchored" data-number="7.3" data-anchor-id="counting-cases"><span class="header-section-number">7.3</span> Counting cases</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><code>from</code>: Whether the message was listed as from anyone (this is usually set by default for regular outgoing email).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="sc">|&gt;</span> <span class="fu">count</span>(spam, from)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  spam  from      n
  &lt;fct&gt; &lt;fct&gt; &lt;int&gt;
1 0     1      2837
2 1     0         3
3 1     1       296</code></pre>
</div>
</div>
<p><em>No non-spam mails without <code>from</code>.</em></p>
</div><div class="column" style="width:50%;">
<p><code>sent_mail</code>: Indicator for whether the sender had been sent an email from the receiver in the last 30 days.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="sc">|&gt;</span> <span class="fu">count</span>(spam, sent_email)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  spam  sent_email     n
  &lt;fct&gt; &lt;fct&gt;      &lt;int&gt;
1 0     0           1972
2 0     1            865
3 1     0            299</code></pre>
</div>
</div>
<p><em>No spam mails with <code>sent_email</code>.</em></p>
</div>
</div>
<ul>
<li>There is <em>incomplete separation</em> in the data for those variables.</li>
<li>That mean we have a <em>sure</em> prediction probabilities (0 or 1). (That is the warning. Also, these variables have the highest coefficients.)</li>
<li>This is not what we assume about reality. Maybe our sample is too small to see it.</li>
<li>Therefore we exclude these variables.</li>
</ul>
</section>
<section id="look-at-numerical-variables" class="level2 smaller" data-number="7.4">
<h2 class="smaller anchored" data-number="7.4" data-anchor-id="look-at-numerical-variables"><span class="header-section-number">7.4</span> Look at numerical variables</h2>
<div class="cell" data-output-location="column">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">group_by</span>(spam) <span class="sc">|&gt;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">|&gt;</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">pivot_longer</span>(<span class="sc">-</span>spam) <span class="sc">|&gt;</span> </span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">group_by</span>(name, spam) <span class="sc">|&gt;</span> </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value), <span class="at">sd =</span> <span class="fu">sd</span>(value)) <span class="sc">|&gt;</span> </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">22</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `spam`
`summarise()` has grouped output by 'name'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 22 × 4
# Groups:   name [11]
   name         spam       mean       sd
   &lt;chr&gt;        &lt;fct&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 attach       0       0.124     0.775 
 2 attach       1       0.227     0.620 
 3 cc           0       0.393     2.62  
 4 cc           1       0.388     3.25  
 5 dollar       0       1.56      5.33  
 6 dollar       1       0.779     3.01  
 7 exclaim_mess 0       6.68     50.2   
 8 exclaim_mess 1       8.75     88.4   
 9 exclaim_subj 0       0.0783    0.269 
10 exclaim_subj 1       0.0769    0.267 
11 image        0       0.0536    0.503 
12 image        1       0.00334   0.0578
13 inherit      0       0.0352    0.216 
14 inherit      1       0.0702    0.554 
15 line_breaks  0     247.      326.    
16 line_breaks  1     108.      321.    
17 num_char     0      11.4      14.9   
18 num_char     1       5.63     15.7   
19 password     0       0.112     0.938 
20 password     1       0.0201    0.182 
21 viagra       0       0         0     
22 viagra       1       0.0268    0.463 </code></pre>
</div>
</div>
<p><code>viagra</code> has no mentions in non-spam emails.</p>
<ul>
<li>We should exclude this variable for the same reason.</li>
</ul>
</section>
<section id="fit-a-model-to-the-training-dataset-1" class="level2 smaller page-columns page-full" data-number="7.5">
<h2 class="smaller anchored" data-number="7.5" data-anchor-id="fit-a-model-to-the-training-dataset-1"><span class="header-section-number">7.5</span> Fit a model to the training dataset</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>email_fit <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(spam <span class="sc">~</span> . <span class="sc">-</span> from <span class="sc">-</span> sent_email <span class="sc">-</span> viagra, <span class="at">data =</span> train_data, <span class="at">family =</span> <span class="st">"binomial"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>email_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>parsnip model object


Call:  stats::glm(formula = spam ~ . - from - sent_email - viagra, family = stats::binomial, 
    data = data)

Coefficients:
 (Intercept)  to_multiple1            cc          time         image  
  -9.867e+01    -2.505e+00     1.944e-02     7.396e-08    -2.854e+00  
      attach        dollar     winneryes       inherit      password  
   5.070e-01    -6.440e-02     2.170e+00     4.499e-01    -7.065e-01  
    num_char   line_breaks       format1      re_subj1  exclaim_subj  
   5.870e-02    -5.420e-03    -9.017e-01    -2.995e+00     1.002e-01  
urgent_subj1  exclaim_mess   numbersmall     numberbig  
   3.572e+00     1.009e-02    -8.518e-01    -1.329e-01  

Degrees of Freedom: 3135 Total (i.e. Null);  3117 Residual
Null Deviance:      1974 
Residual Deviance: 1447     AIC: 1485</code></pre>
</div>
</div>
<p>We still get a warning, but without very high coefficients.</p>

<div class="no-row-height column-margin column-container"><div class="margin-aside">
<p>A deeper analysis shows that now only two cases are predicted not spam with 100% probability.</p>
</div></div></section>
<section id="predict-with-the-testing-dataset" class="level2 smaller" data-number="7.6">
<h2 class="smaller anchored" data-number="7.6" data-anchor-id="predict-with-the-testing-dataset"><span class="header-section-number">7.6</span> Predict with the testing dataset</h2>
<p>Predicting the raw values (log-odds)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(email_fit, test_data, <span class="at">type =</span> <span class="st">"raw"</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>() <span class="co"># head prints the first values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3         4         5         6 
-4.942500 -6.312226 -3.938487 -6.688992 -4.399541 -1.587700 </code></pre>
</div>
</div>
<div class="columns">
<div class="column" style="width:50%;">
<p>Predicting probabilities</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(email_fit, test_data, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  .pred_0 .pred_1
    &lt;dbl&gt;   &lt;dbl&gt;
1   0.993 0.00709
2   0.998 0.00181
3   0.981 0.0191 
4   0.999 0.00124
5   0.988 0.0121 
6   0.830 0.170  </code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>Predicting spam (default)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(email_fit, test_data) <span class="co"># Would be type = "class"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 785 × 1
   .pred_class
   &lt;fct&gt;      
 1 0          
 2 0          
 3 0          
 4 0          
 5 0          
 6 0          
 7 0          
 8 0          
 9 0          
10 0          
# ℹ 775 more rows</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="relate-back-to-the-model-concept" class="level2 smaller" data-number="7.7">
<h2 class="smaller anchored" data-number="7.7" data-anchor-id="relate-back-to-the-model-concept"><span class="header-section-number">7.7</span> Relate back to the model concept</h2>
<div class="cell" data-output-location="column">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>email_pred <span class="ot">&lt;-</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">predict</span>(email_fit, test_data, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">|&gt;</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">select</span>(<span class="at">spam_prob =</span> .pred_1) <span class="sc">|&gt;</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(<span class="at">spam_logodds =</span> </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">predict</span>(email_fit, test_data, <span class="at">type =</span> <span class="st">"raw"</span>), </span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">spam_odds =</span> <span class="fu">exp</span>(spam_logodds)) <span class="sc">|&gt;</span> </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">bind_cols</span>(<span class="fu">predict</span>(email_fit, test_data)) <span class="sc">|&gt;</span> </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a> <span class="co"># Append real data</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a> <span class="fu">bind_cols</span>(test_data <span class="sc">|&gt;</span> <span class="fu">select</span>(spam)) </span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>email_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 785 × 5
   spam_prob spam_logodds spam_odds .pred_class spam 
       &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;       &lt;fct&gt;
 1   0.00709        -4.94   0.00714 0           0    
 2   0.00181        -6.31   0.00181 0           0    
 3   0.0191         -3.94   0.0195  0           0    
 4   0.00124        -6.69   0.00124 0           0    
 5   0.0121         -4.40   0.0123  0           0    
 6   0.170          -1.59   0.204   0           0    
 7   0.0410         -3.15   0.0427  0           0    
 8   0.139          -1.83   0.161   0           0    
 9   0.0617         -2.72   0.0657  0           0    
10   0.0983         -2.22   0.109   0           0    
# ℹ 775 more rows</code></pre>
</div>
</div>
<ul>
<li>The raw predictions are the log-odds.</li>
<li>From which we can compute the odds.</li>
<li>From which the probability is computed. Here it is done by <code>predict</code>.</li>
<li>The <code>.pred_class</code> prediction is when the probability &gt; 0.5.
<ul>
<li>What does it mean for the odds and the log-odds?</li>
</ul></li>
</ul>
<p>. . .</p>
<p>Answers: odds &gt; 1, log-odds &gt; 0</p>
</section>
<section id="another-look" class="level2 smaller" data-number="7.8">
<h2 class="smaller anchored" data-number="7.8" data-anchor-id="another-look"><span class="header-section-number">7.8</span> Another look</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>email_pred <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(spam_prob)) <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 785 × 5
   spam_prob spam_logodds spam_odds .pred_class spam 
       &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;       &lt;fct&gt;
 1     0.903       2.23       9.29  1           1    
 2     0.833       1.60       4.98  1           0    
 3     0.825       1.55       4.71  1           1    
 4     0.733       1.01       2.75  1           1    
 5     0.683       0.766      2.15  1           1    
 6     0.626       0.517      1.68  1           1    
 7     0.614       0.464      1.59  1           0    
 8     0.597       0.392      1.48  1           1    
 9     0.538       0.153      1.17  1           1    
10     0.537       0.148      1.16  1           0    
11     0.510       0.0404     1.04  1           0    
12     0.491      -0.0345     0.966 0           0    
13     0.490      -0.0407     0.960 0           0    
14     0.489      -0.0453     0.956 0           1    
15     0.483      -0.0698     0.933 0           1    
16     0.473      -0.107      0.899 0           0    
17     0.463      -0.150      0.861 0           0    
18     0.457      -0.174      0.840 0           0    
19     0.447      -0.212      0.809 0           0    
20     0.447      -0.214      0.808 0           1    
# ℹ 765 more rows</code></pre>
</div>
</div>
<p>We see false positives and false negatives.</p>
</section>
<section id="evaluate-the-performance" class="level2 smaller" data-number="7.9">
<h2 class="smaller anchored" data-number="7.9" data-anchor-id="evaluate-the-performance"><span class="header-section-number">7.9</span> Evaluate the performance</h2>
<p><strong>Receiver operating characteristic (ROC) curve</strong><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> which plots true positive rate (sensitivity) vs.&nbsp;false positive rate (1 - specificity)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>email_pred <span class="sc">|&gt;</span> <span class="fu">roc_curve</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">truth =</span> spam, spam_prob,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">event_level =</span> <span class="st">"second"</span> <span class="co"># this adjusts the location above the diagonal</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W08_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="evaluate-the-performance-1" class="level2 smaller" data-number="7.10">
<h2 class="smaller anchored" data-number="7.10" data-anchor-id="evaluate-the-performance-1"><span class="header-section-number">7.10</span> Evaluate the performance</h2>
<p>Find the area under the curve (AUC).</p>
<p>In calculus language:<br>
<span class="math inline">\(\int_0^1 \text{TPR}(\text{FPR}) d\text{FPR}\)</span></p>
<p>Remember:</p>
<ul>
<li>TPR = True Positive Rate = sensitivity</li>
<li>FPR = False Positive Rate = 1 - specificity</li>
<li>specificity is the true negative rate.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>email_pred <span class="sc">|&gt;</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_auc</span>(</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">truth =</span> spam,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    spam_prob,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">event_level =</span> <span class="st">"second"</span> </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.857</code></pre>
</div>
</div>
</section>
</section>
<section id="feature-engineering" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Feature engineering</h1>
<section id="feature-engineering-1" class="level2 smaller" data-number="8.1">
<h2 class="smaller anchored" data-number="8.1" data-anchor-id="feature-engineering-1"><span class="header-section-number">8.1</span> Feature engineering</h2>
<ul>
<li>We prefer simple models when possible, but <strong>parsimony</strong> does not mean sacrificing accuracy (or predictive performance) in the interest of simplicity</li>
<li>Variables that go into the model and how they are represented are critical to the success of the model</li>
<li><strong>Feature engineering</strong> is getting creative with our predictors in an effort to make them more useful for our model (to increase its predictive performance)</li>
</ul>
</section>
<section id="modeling-workflow-revisited" class="level2 smaller" data-number="8.2">
<h2 class="smaller anchored" data-number="8.2" data-anchor-id="modeling-workflow-revisited"><span class="header-section-number">8.2</span> Modeling workflow, revisited</h2>
<ul>
<li><p>Create a <strong>recipe</strong> for feature engineering steps to be applied to the training data</p>
<ul>
<li>The <code>tidymodels</code> way (similar to a pipeline in python’s scikit-learn).</li>
</ul></li>
<li><p>Fit the model to the training data after these steps have been applied</p></li>
<li><p>Using the model estimates from the training data, predict outcomes for the test data</p></li>
<li><p>Evaluate the performance of the model on the test data</p></li>
</ul>
</section>
</section>
<section id="recipes" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Recipes</h1>
<section id="initiate-a-recipe" class="level2 smaller" data-number="9.1">
<h2 class="smaller anchored" data-number="9.1" data-anchor-id="initiate-a-recipe"><span class="header-section-number">9.1</span> Initiate a recipe</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>email_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a> spam <span class="sc">~</span> .,          <span class="co"># formula</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a> <span class="at">data =</span> train_data  <span class="co"># data to use for cataloguing names and types of variables</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(email_rec) <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 4
   variable     type      role      source  
   &lt;chr&gt;        &lt;list&gt;    &lt;chr&gt;     &lt;chr&gt;   
 1 to_multiple  &lt;chr [3]&gt; predictor original
 2 from         &lt;chr [3]&gt; predictor original
 3 cc           &lt;chr [2]&gt; predictor original
 4 sent_email   &lt;chr [3]&gt; predictor original
 5 time         &lt;chr [1]&gt; predictor original
 6 image        &lt;chr [2]&gt; predictor original
 7 attach       &lt;chr [2]&gt; predictor original
 8 dollar       &lt;chr [2]&gt; predictor original
 9 winner       &lt;chr [3]&gt; predictor original
10 inherit      &lt;chr [2]&gt; predictor original
11 viagra       &lt;chr [2]&gt; predictor original
12 password     &lt;chr [2]&gt; predictor original
13 num_char     &lt;chr [2]&gt; predictor original
14 line_breaks  &lt;chr [2]&gt; predictor original
15 format       &lt;chr [3]&gt; predictor original
16 re_subj      &lt;chr [3]&gt; predictor original
17 exclaim_subj &lt;chr [2]&gt; predictor original
18 urgent_subj  &lt;chr [3]&gt; predictor original
19 exclaim_mess &lt;chr [2]&gt; predictor original
20 number       &lt;chr [3]&gt; predictor original
21 spam         &lt;chr [3]&gt; outcome   original</code></pre>
</div>
</div>
<p>The object <code>email_rec</code> only includes <em>meta-data</em> (columns names and types)!</p>
</section>
<section id="remove-certain-variables" class="level2 smaller" data-number="9.2">
<h2 class="smaller anchored" data-number="9.2" data-anchor-id="remove-certain-variables"><span class="header-section-number">9.2</span> Remove certain variables</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>email_rec <span class="sc">|&gt;</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(from, sent_email, viagra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 20</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: from, sent_email, viagra</code></pre>
</div>
</div>
</section>
<section id="feature-engineer-date" class="level2 smaller" data-number="9.3">
<h2 class="smaller anchored" data-number="9.3" data-anchor-id="feature-engineer-date"><span class="header-section-number">9.3</span> Feature engineer date</h2>
<ul>
<li>The date-time may not be such an interesting predictor.
<ul>
<li>It could only bring in a general trend over time</li>
</ul></li>
<li>Often decomposing the date to the month or the day of the week (dow) is more interesting.
<ul>
<li><code>step_date</code> can easily extract these</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>email_rec <span class="sc">|&gt;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_rm</span>(from, sent_email, viagra) <span class="sc">|&gt;</span> </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_date</span>(time, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"dow"</span>, <span class="st">"month"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_rm</span>(time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 20</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: from, sent_email, viagra</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Date features from: time</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: time</code></pre>
</div>
</div>
</section>
<section id="create-dummy-variables" class="level2 smaller" data-number="9.4">
<h2 class="smaller anchored" data-number="9.4" data-anchor-id="create-dummy-variables"><span class="header-section-number">9.4</span> Create dummy variables</h2>
<ul>
<li>Use helper functions like <code>all_nominal</code> or <code>all_outcomes</code> from <code>tidymodels</code> for column selection.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>email_rec <span class="sc">|&gt;</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_rm</span>(from, sent_email, viagra) <span class="sc">|&gt;</span> </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_date</span>(time, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"dow"</span>, <span class="st">"month"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_rm</span>(time) <span class="sc">|&gt;</span> </span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 20</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: from, sent_email, viagra</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Date features from: time</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: time</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: all_nominal() -all_outcomes()</code></pre>
</div>
</div>
</section>
<section id="remove-zero-variance-variables" class="level2 smaller" data-number="9.5">
<h2 class="smaller anchored" data-number="9.5" data-anchor-id="remove-zero-variance-variables"><span class="header-section-number">9.5</span> Remove zero variance variables</h2>
<p>Variables that contain only a single value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>email_rec <span class="sc">|&gt;</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_rm</span>(from, sent_email, viagra) <span class="sc">|&gt;</span> </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_date</span>(time, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"dow"</span>, <span class="st">"month"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_rm</span>(time) <span class="sc">|&gt;</span> </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 20</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: from, sent_email, viagra</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Date features from: time</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: time</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: all_nominal() -all_outcomes()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Zero variance filter on: all_predictors()</code></pre>
</div>
</div>
</section>
<section id="full-recipe" class="level2 smaller" data-number="9.6">
<h2 class="smaller anchored" data-number="9.6" data-anchor-id="full-recipe"><span class="header-section-number">9.6</span> Full recipe</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>email_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a> spam <span class="sc">~</span> .,          <span class="co"># formula</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a> <span class="at">data =</span> train_data  <span class="co"># data to use for cataloguing names and types of variables</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_rm</span>(from, sent_email, viagra) <span class="sc">|&gt;</span> </span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_date</span>(time, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"dow"</span>, <span class="st">"month"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_rm</span>(time) <span class="sc">|&gt;</span> </span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(email_rec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 20</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: from, sent_email, viagra</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Date features from: time</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: time</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: all_nominal() -all_outcomes()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Zero variance filter on: all_predictors()</code></pre>
</div>
</div>
<p>The object <code>email_rec</code> only includes <em>meta-data</em> of the data frame it shall work on (a formula, columns names and types)!</p>
</section>
</section>
<section id="building-workflows" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Building workflows</h1>
<section id="define-model" class="level2 smaller" data-number="10.1">
<h2 class="smaller anchored" data-number="10.1" data-anchor-id="define-model"><span class="header-section-number">10.1</span> Define model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>email_mod <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>email_mod</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Logistic Regression Model Specification (classification)

Computational engine: glm </code></pre>
</div>
</div>
</section>
<section id="define-workflow" class="level2 smaller" data-number="10.2">
<h2 class="smaller anchored" data-number="10.2" data-anchor-id="define-workflow"><span class="header-section-number">10.2</span> Define workflow</h2>
<p><strong>Workflows</strong> bring together models and recipes so that they can be easily applied to both the training and test data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>email_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(email_mod) <span class="sc">|&gt;</span> </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(email_rec)</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>email_wflow</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: logistic_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
5 Recipe Steps

• step_rm()
• step_date()
• step_rm()
• step_dummy()
• step_zv()

── Model ───────────────────────────────────────────────────────────────────────
Logistic Regression Model Specification (classification)

Computational engine: glm </code></pre>
</div>
</div>
</section>
<section id="fit-model-to-training-data" class="level2 smaller" data-number="10.3">
<h2 class="smaller anchored" data-number="10.3" data-anchor-id="fit-model-to-training-data"><span class="header-section-number">10.3</span> Fit model to training data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>email_fit <span class="ot">&lt;-</span> email_wflow <span class="sc">|&gt;</span> </span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> train_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(email_fit) <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">27</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 5
   term            estimate std.error statistic  p.value
   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercept)     -0.651     0.254     -2.57   1.03e- 2
 2 cc               0.0214    0.0229     0.936  3.49e- 1
 3 image           -2.99      1.31      -2.28   2.28e- 2
 4 attach           0.512     0.116      4.41   1.03e- 5
 5 dollar          -0.0651    0.0307    -2.12   3.40e- 2
 6 inherit          0.440     0.205      2.15   3.14e- 2
 7 password        -0.723     0.302     -2.39   1.67e- 2
 8 num_char         0.0585    0.0240     2.43   1.50e- 2
 9 line_breaks     -0.00548   0.00139   -3.94   8.24e- 5
10 exclaim_subj     0.0998    0.268      0.373  7.09e- 1
11 exclaim_mess     0.0103    0.00198    5.20   2.02e- 7
12 to_multiple_X1  -2.56      0.339     -7.56   4.11e-14
13 winner_yes       2.24      0.430      5.21   1.90e- 7
14 format_X1       -0.953     0.157     -6.06   1.38e- 9
15 re_subj_X1      -3.00      0.444     -6.76   1.39e-11
16 urgent_subj_X1   3.69      1.15       3.20   1.37e- 3
17 number_small    -0.840     0.162     -5.20   1.98e- 7
18 number_big      -0.0915    0.244     -0.375  7.07e- 1
19 time_dow_Mon    -0.326     0.303     -1.08   2.82e- 1
20 time_dow_Tue     0.0813    0.275      0.296  7.67e- 1
21 time_dow_Wed    -0.260     0.275     -0.946  3.44e- 1
22 time_dow_Thu    -0.220     0.279     -0.788  4.31e- 1
23 time_dow_Fri    -0.0612    0.275     -0.223  8.24e- 1
24 time_dow_Sat     0.0646    0.292      0.221  8.25e- 1
25 time_month_Feb   0.760     0.178      4.26   2.03e- 5
26 time_month_Mar   0.506     0.178      2.85   4.40e- 3
27 time_month_Apr -12.0     394.        -0.0306 9.76e- 1</code></pre>
</div>
</div>
</section>
<section id="make-predictions-for-test-data" class="level2 smaller" data-number="10.4">
<h2 class="smaller anchored" data-number="10.4" data-anchor-id="make-predictions-for-test-data"><span class="header-section-number">10.4</span> Make predictions for test data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>email_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(email_fit, test_data, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(test_data) </span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>email_pred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 785 × 23
   .pred_0  .pred_1 spam  to_multiple from     cc sent_email time               
     &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;       &lt;fct&gt; &lt;int&gt; &lt;fct&gt;      &lt;dttm&gt;             
 1   0.993 0.00653  0     1           1         0 1          2012-01-01 18:55:06
 2   0.998 0.00169  0     0           1         1 1          2012-01-01 20:38:32
 3   0.987 0.0127   0     0           1         0 0          2012-01-02 06:42:16
 4   0.999 0.000825 0     0           1         1 0          2012-01-02 16:12:51
 5   0.991 0.00876  0     0           1         4 0          2012-01-02 17:45:36
 6   0.878 0.122    0     0           1         0 0          2012-01-02 22:55:03
 7   0.959 0.0414   0     0           1         0 0          2012-01-03 02:07:17
 8   0.852 0.148    0     0           1         0 0          2012-01-03 06:41:35
 9   0.938 0.0619   0     0           1         0 0          2012-01-03 17:02:35
10   0.896 0.104    0     0           1         0 0          2012-01-03 12:14:51
# ℹ 775 more rows
# ℹ 15 more variables: image &lt;dbl&gt;, attach &lt;dbl&gt;, dollar &lt;dbl&gt;, winner &lt;fct&gt;,
#   inherit &lt;dbl&gt;, viagra &lt;dbl&gt;, password &lt;dbl&gt;, num_char &lt;dbl&gt;,
#   line_breaks &lt;int&gt;, format &lt;fct&gt;, re_subj &lt;fct&gt;, exclaim_subj &lt;dbl&gt;,
#   urgent_subj &lt;fct&gt;, exclaim_mess &lt;dbl&gt;, number &lt;fct&gt;</code></pre>
</div>
</div>
</section>
<section id="evaluate-the-performance-2" class="level2 smaller" data-number="10.5">
<h2 class="smaller anchored" data-number="10.5" data-anchor-id="evaluate-the-performance-2"><span class="header-section-number">10.5</span> Evaluate the performance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>email_pred <span class="sc">|&gt;</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">truth =</span> spam,</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>    .pred_1,</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">event_level =</span> <span class="st">"second"</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W08_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="evaluate-the-performance-3" class="level2 smaller" data-number="10.6">
<h2 class="smaller anchored" data-number="10.6" data-anchor-id="evaluate-the-performance-3"><span class="header-section-number">10.6</span> Evaluate the performance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>email_pred <span class="sc">|&gt;</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_auc</span>(</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">truth =</span> spam,</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>    .pred_1,</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">event_level =</span> <span class="st">"second"</span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.860</code></pre>
</div>
</div>
<p>This is better than our former model (without the feature engineering workflow), which had AUC = 0.857.</p>
</section>
</section>
<section id="from-probabilities-to-decisions" class="level1 smaller" data-number="11">
<h1 class="smaller" data-number="11"><span class="header-section-number">11</span> From probabilities to decisions</h1>
<section id="cutoff-probability-0.5" class="level2 smaller" data-number="11.1">
<h2 class="smaller anchored" data-number="11.1" data-anchor-id="cutoff-probability-0.5"><span class="header-section-number">11.1</span> Cutoff probability: 0.5</h2>
<p>Suppose we decide to label an email as spam if the model predicts the probability of spam to be <strong>more than 0.5</strong>. (That is the default.)</p>
<p><strong>Confusion matrix:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>cutoff_prob <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>email_pred <span class="sc">|&gt;</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">spam      =</span> <span class="fu">if_else</span>(spam <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Email is spam"</span>, <span class="st">"Email is not spam"</span>),</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">spam_pred =</span> <span class="fu">if_else</span>(.pred_1 <span class="sc">&gt;</span> cutoff_prob, <span class="st">"Email labelled spam"</span>, <span class="st">"Email labelled not spam"</span>)</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(spam_pred, spam) <span class="sc">|&gt;</span></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> spam_pred, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> <span class="co"># reorder rows and cols to fit convention</span></span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">spam</th>
<th style="text-align: right;">Email labelled spam</th>
<th style="text-align: right;">Email labelled not spam</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Email is spam</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="even">
<td style="text-align: left;">Email is not spam</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">707</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Sensitivity:</strong> 14/(14+54) = 0.206<br>
<strong>Specificity:</strong> 707/(707+10) = 0.986</p>
</section>
<section id="cutoff-probability-0.25" class="level2 smaller" data-number="11.2">
<h2 class="smaller anchored" data-number="11.2" data-anchor-id="cutoff-probability-0.25"><span class="header-section-number">11.2</span> Cutoff probability: 0.25</h2>
<p>Suppose we decide to label an email as spam if the model predicts the probability of spam to be <strong>more than 0.25</strong>.</p>
<p><strong>Confusion matrix:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>cutoff_prob <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>email_pred <span class="sc">|&gt;</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">spam      =</span> <span class="fu">if_else</span>(spam <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Email is spam"</span>, <span class="st">"Email is not spam"</span>),</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">spam_pred =</span> <span class="fu">if_else</span>(.pred_1 <span class="sc">&gt;</span> cutoff_prob, <span class="st">"Email labelled spam"</span>, <span class="st">"Email labelled not spam"</span>)</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(spam_pred, spam) <span class="sc">|&gt;</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> spam_pred, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> <span class="co"># reorder rows and cols to fit convention</span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">spam</th>
<th style="text-align: right;">Email labelled spam</th>
<th style="text-align: right;">Email labelled not spam</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Email is spam</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">36</td>
</tr>
<tr class="even">
<td style="text-align: left;">Email is not spam</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">656</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Sensitivity:</strong> 32/(32+36) = 0.471<br>
<strong>Specificity:</strong> 656/(656 + 61) = 0.915</p>
</section>
<section id="cutoff-probability-0.75" class="level2 smaller" data-number="11.3">
<h2 class="smaller anchored" data-number="11.3" data-anchor-id="cutoff-probability-0.75"><span class="header-section-number">11.3</span> Cutoff probability: 0.75</h2>
<p>Suppose we decide to label an email as spam if the model predicts the probability of spam to be <strong>more than 0.75</strong>.</p>
<p><strong>Confusion matrix:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>cutoff_prob <span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>email_pred <span class="sc">|&gt;</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">spam      =</span> <span class="fu">if_else</span>(spam <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Email is spam"</span>, <span class="st">"Email is not spam"</span>),</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">spam_pred =</span> <span class="fu">if_else</span>(.pred_1 <span class="sc">&gt;</span> cutoff_prob, <span class="st">"Email labelled spam"</span>, <span class="st">"Email labelled not spam"</span>)</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(spam_pred, spam) <span class="sc">|&gt;</span></span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> spam_pred, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> <span class="co"># reorder rows and cols to fit convention</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">spam</th>
<th style="text-align: right;">Email labelled spam</th>
<th style="text-align: right;">Email labelled not spam</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Email is spam</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">65</td>
</tr>
<tr class="even">
<td style="text-align: left;">Email is not spam</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">716</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Sensitivity:</strong> 3/(3+65) = 0.044<br>
<strong>Specificity:</strong> 716/(716+1) = 0.999</p>
</section>
<section id="check-our-very-first-model" class="level2 smaller" data-number="11.4">
<h2 class="smaller anchored" data-number="11.4" data-anchor-id="check-our-very-first-model"><span class="header-section-number">11.4</span> Check our very first model</h2>
<p>We make a new simple recipe and draw workflow and fitting re-using the same specified logisitc regression model <code>email_mod</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>simple_email_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a> spam <span class="sc">~</span> num_char,          <span class="co"># formula</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a> <span class="at">data =</span> train_data  <span class="co"># data to use for cataloguing names and types of variables</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>simple_email_pred <span class="ot">&lt;-</span> </span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> </span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">add_model</span>(email_mod) <span class="sc">|&gt;</span> </span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">add_recipe</span>(simple_email_rec) <span class="sc">|&gt;</span> </span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a> <span class="fu">fit</span>(<span class="at">data =</span> train_data) <span class="sc">|&gt;</span> </span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a> <span class="fu">predict</span>(test_data, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a> <span class="fu">bind_cols</span>(test_data <span class="sc">|&gt;</span> <span class="fu">select</span>(spam,num_char,time)) </span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>simple_email_pred </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 785 × 5
   .pred_0 .pred_1 spam  num_char time               
     &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;    &lt;dbl&gt; &lt;dttm&gt;             
 1   0.889  0.111  0        4.84  2012-01-01 18:55:06
 2   0.936  0.0644 0       15.1   2012-01-01 20:38:32
 3   0.945  0.0547 0       18.0   2012-01-02 06:42:16
 4   0.989  0.0113 0       45.8   2012-01-02 16:12:51
 5   0.922  0.0784 0       11.4   2012-01-02 17:45:36
 6   0.868  0.132  0        1.48  2012-01-02 22:55:03
 7   0.933  0.0667 0       14.4   2012-01-03 02:07:17
 8   0.864  0.136  0        0.978 2012-01-03 06:41:35
 9   0.905  0.0953 0        7.79  2012-01-03 17:02:35
10   0.864  0.136  0        0.978 2012-01-03 12:14:51
# ℹ 775 more rows</code></pre>
</div>
</div>
</section>
<section id="evaluate-the-performance-4" class="level2 smaller" data-number="11.5">
<h2 class="smaller anchored" data-number="11.5" data-anchor-id="evaluate-the-performance-4"><span class="header-section-number">11.5</span> Evaluate the performance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>simple_email_pred <span class="sc">|&gt;</span> <span class="fu">roc_curve</span>(</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">truth =</span> spam, </span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>    .pred_1,</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">event_level =</span> <span class="st">"second"</span> <span class="co"># this adjusts the location above the diagonal</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W08_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>simple_email_pred <span class="sc">|&gt;</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_auc</span>(</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">truth =</span> spam,</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>    .pred_1,</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">event_level =</span> <span class="st">"second"</span> </span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.753</code></pre>
</div>
</div>
<p><strong>Conclusion:</strong> It is not as good compared to AUC 0.86</p>
</section>
<section id="predict-penguins-sex" class="level2 scrollable smaller" data-number="11.6">
<h2 class="scrollable smaller anchored" data-number="11.6" data-anchor-id="predict-penguins-sex"><span class="header-section-number">11.6</span> Predict Penguins’ Sex</h2>
<p>Following all the steps introduced before:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Put 80% of the data into the training set </span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>peng_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(penguins, <span class="at">prop =</span> <span class="fl">0.80</span>)</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frames for the two sets:</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>train_data_peng <span class="ot">&lt;-</span> <span class="fu">training</span>(peng_split)</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>test_data_peng  <span class="ot">&lt;-</span> <span class="fu">testing</span>(peng_split)</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a recipe for the model</span></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>peng_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a> sex <span class="sc">~</span> .,</span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a> <span class="at">data =</span> train_data_peng </span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_naomit</span>(<span class="fu">all_predictors</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a> <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb153-16"><a href="#cb153-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-17"><a href="#cb153-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a logistic regression model </span></span>
<span id="cb153-18"><a href="#cb153-18" aria-hidden="true" tabindex="-1"></a>peng_mod <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb153-19"><a href="#cb153-19" aria-hidden="true" tabindex="-1"></a> <span class="fu">set_engine</span>(<span class="st">"glm"</span>)</span>
<span id="cb153-20"><a href="#cb153-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-21"><a href="#cb153-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a workflow</span></span>
<span id="cb153-22"><a href="#cb153-22" aria-hidden="true" tabindex="-1"></a>peng_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span> </span>
<span id="cb153-23"><a href="#cb153-23" aria-hidden="true" tabindex="-1"></a> <span class="fu">add_model</span>(peng_mod) <span class="sc">|&gt;</span> </span>
<span id="cb153-24"><a href="#cb153-24" aria-hidden="true" tabindex="-1"></a> <span class="fu">add_recipe</span>(peng_rec)</span>
<span id="cb153-25"><a href="#cb153-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-26"><a href="#cb153-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting model to training data</span></span>
<span id="cb153-27"><a href="#cb153-27" aria-hidden="true" tabindex="-1"></a>peng_fit <span class="ot">&lt;-</span> peng_wflow <span class="sc">|&gt;</span> </span>
<span id="cb153-28"><a href="#cb153-28" aria-hidden="true" tabindex="-1"></a> <span class="fu">fit</span>(<span class="at">data =</span> train_data_peng)</span>
<span id="cb153-29"><a href="#cb153-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-30"><a href="#cb153-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions for test data</span></span>
<span id="cb153-31"><a href="#cb153-31" aria-hidden="true" tabindex="-1"></a>peng_pred <span class="ot">&lt;-</span> peng_fit <span class="sc">|&gt;</span> </span>
<span id="cb153-32"><a href="#cb153-32" aria-hidden="true" tabindex="-1"></a> <span class="fu">predict</span>(test_data_peng, <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb153-33"><a href="#cb153-33" aria-hidden="true" tabindex="-1"></a> <span class="fu">bind_cols</span>(test_data_peng)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="penguins-evaluate-performance" class="level2 smaller" data-number="11.7">
<h2 class="smaller anchored" data-number="11.7" data-anchor-id="penguins-evaluate-performance"><span class="header-section-number">11.7</span> Penguins: Evaluate Performance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>peng_pred <span class="sc">|&gt;</span> <span class="fu">roc_curve</span>(</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">truth =</span> sex,  .pred_male, <span class="at">event_level =</span> <span class="st">"second"</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W08_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>peng_pred <span class="sc">|&gt;</span> <span class="fu">roc_auc</span>(</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a> <span class="at">truth =</span> sex, .pred_male, <span class="at">event_level =</span> <span class="st">"second"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.958</code></pre>
</div>
</div>
</section>
<section id="penguins-cutoff-probability-0.5" class="level2 smaller" data-number="11.8">
<h2 class="smaller anchored" data-number="11.8" data-anchor-id="penguins-cutoff-probability-0.5"><span class="header-section-number">11.8</span> Penguins: Cutoff probability 0.5</h2>
<p><strong>Confusion matrix:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>cutoff_prob <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>peng_pred <span class="sc">|&gt;</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex      =</span> <span class="fu">if_else</span>(sex <span class="sc">==</span> <span class="st">"male"</span>, <span class="st">"Penguin is male"</span>, <span class="st">"Penguin is female"</span>),</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex_pred =</span> <span class="fu">if_else</span>(.pred_male <span class="sc">&gt;</span> cutoff_prob, <span class="st">"Penguin labelled male"</span>, <span class="st">"Penguin labelled female"</span>)</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex_pred, sex) <span class="sc">|&gt;</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> sex_pred, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> <span class="co"># reorder rows and cols to fit convention</span></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">sex</th>
<th style="text-align: right;">Penguin labelled male</th>
<th style="text-align: right;">Penguin labelled female</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Penguin is male</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Penguin is female</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">28</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Sensitivity:</strong> 31/(31+4) = 0.886<br>
<strong>Specificity:</strong> 28/(28+4) = 0.875</p>
</section>
<section id="penguins-cutoff-probability-0.25" class="level2 smaller" data-number="11.9">
<h2 class="smaller anchored" data-number="11.9" data-anchor-id="penguins-cutoff-probability-0.25"><span class="header-section-number">11.9</span> Penguins: Cutoff probability 0.25</h2>
<p><strong>Confusion matrix:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>cutoff_prob <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>peng_pred <span class="sc">|&gt;</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex      =</span> <span class="fu">if_else</span>(sex <span class="sc">==</span> <span class="st">"male"</span>, <span class="st">"Penguin is male"</span>, <span class="st">"Penguin is female"</span>),</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex_pred =</span> <span class="fu">if_else</span>(.pred_male <span class="sc">&gt;</span> cutoff_prob, <span class="st">"Penguin labelled male"</span>, <span class="st">"Penguin labelled female"</span>)</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex_pred, sex) <span class="sc">|&gt;</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> sex_pred, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> <span class="co"># reorder rows and cols to fit convention</span></span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">sex</th>
<th style="text-align: right;">Penguin labelled male</th>
<th style="text-align: right;">Penguin labelled female</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Penguin is male</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Penguin is female</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">25</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Sensitivity:</strong> 34/(34+1) = 0.971<br>
<strong>Specificity:</strong> 25/(25+7) = 0.781</p>
</section>
<section id="penguins-cutoff-probability-0.75" class="level2 smaller" data-number="11.10">
<h2 class="smaller anchored" data-number="11.10" data-anchor-id="penguins-cutoff-probability-0.75"><span class="header-section-number">11.10</span> Penguins: Cutoff probability 0.75</h2>
<p><strong>Confusion matrix:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>cutoff_prob <span class="ot">&lt;-</span> <span class="fl">0.75</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>peng_pred <span class="sc">|&gt;</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex      =</span> <span class="fu">if_else</span>(sex <span class="sc">==</span> <span class="st">"male"</span>, <span class="st">"Penguin is male"</span>, <span class="st">"Penguin is female"</span>),</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex_pred =</span> <span class="fu">if_else</span>(.pred_male <span class="sc">&gt;</span> cutoff_prob, <span class="st">"Penguin labelled male"</span>, <span class="st">"Penguin labelled female"</span>)</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex_pred, sex) <span class="sc">|&gt;</span></span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> sex_pred, <span class="at">values_from =</span> n) <span class="sc">|&gt;</span> </span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)) <span class="sc">|&gt;</span> <span class="co"># reorder rows and cols to fit convention</span></span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">sex</th>
<th style="text-align: right;">Penguin labelled male</th>
<th style="text-align: right;">Penguin labelled female</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Penguin is male</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">Penguin is female</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">30</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Sensitivity:</strong> 29/(29+6) = 0.829<br>
<strong>Specificity:</strong> 30/(30+2) = 0.938</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>From Molnar, C. (2022). Modeling mindsets: The many cultures of learning from data. Christoph Molnar c/o Mucbook Clubhouse.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Originally developed for operators of military radar receivers, hence the odd name.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>